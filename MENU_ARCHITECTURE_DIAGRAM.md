# ğŸ¨ ĞĞ Ğ¥Ğ˜Ğ¢Ğ•ĞšĞ¢Ğ£Ğ ĞĞĞ¯ Ğ”Ğ˜ĞĞ“Ğ ĞĞœĞœĞ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ« ĞœĞ•ĞĞ® VoxPersona

## 1. ĞŸĞĞ›ĞĞĞ¯ Ğ˜Ğ•Ğ ĞĞ Ğ¥Ğ˜Ğ¯ ĞœĞ•ĞĞ®

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   TELEGRAM BOT ENTRY POINT       â”‚
                    â”‚   /start Ğ¸Ğ»Ğ¸ 1-Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  auth_filter Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°     â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚  ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½?        â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
                            â”‚            â”‚
                    [Ğ”Ğ]    â”‚            â”‚    [ĞĞ•Ğ¢]
                            â”‚            â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   send_  â”‚    â”‚  auth login    â”‚
                   â”‚  main_   â”‚    â”‚  handle_       â”‚
                   â”‚  menu()  â”‚    â”‚  password_     â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚  input()       â”‚
                        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ğŸ  Ğ“Ğ›ĞĞ’ĞĞĞ• ĞœĞ•ĞĞ®              â”‚
        â”‚  main_menu_markup()           â”‚
        â”‚                               â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ [ğŸ“±] [âš™ï¸] [â“]         â”‚  â”‚
        â”‚  â”‚ Ğ§Ğ°Ñ‚Ñ‹ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ   â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                â”‚             â”‚
            â–¼                                â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ĞœĞ•ĞĞ® Ğ§ĞĞ¢ĞĞ’   â”‚              â”‚Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞĞĞ• ĞœĞ•  â”‚  â”‚ Ğ¡ĞŸĞ ĞĞ’ĞšĞ     â”‚
    â”‚              â”‚              â”‚ĞĞ®            â”‚  â”‚ help_menu   â”‚
    â”‚ menu_chats   â”‚              â”‚              â”‚  â”‚             â”‚
    â”‚              â”‚              â”‚ menu_system  â”‚  â”‚ [Ğ˜Ğ½Ñ„Ğ¾]      â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚              â”‚  â”‚ [â† ĞĞ°Ğ·Ğ°Ğ´]   â”‚
    â”‚ â”‚ [ğŸ†•ĞĞ¾Ğ²Ñ‹Ğ¹]â”‚ â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ â”‚ [ğŸ“ŠĞ¡Ñ‚Ğ°Ñ‚] â”‚ â”‚              â”‚ â”‚[ğŸ“Ğ¥Ñ€Ğ°Ğ½]  â”‚ â”‚
    â”‚ â”‚ [ğŸ“„ĞÑ‚Ñ‡] â”‚ â”‚              â”‚ â”‚[ğŸ”Ğ”Ğ¾ÑÑ‚ÑƒĞ¿]â”‚ â”‚  *Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾
    â”‚ â”‚ [ğŸ’¬Ğ¡Ğ¿]  â”‚ â”‚              â”‚ â”‚[â† ĞĞ°Ğ·Ğ°Ğ´] â”‚ â”‚  super_admin
    â”‚ â”‚ [â† ĞĞ°Ğ·Ğ°Ğ´]â”‚ â”‚              â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚              â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚     â”‚        â”‚                     â”‚
    â”‚ â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚ â”‚ Ğ¡ĞŸĞ˜Ğ¡ĞĞš Ğ§ĞĞ¢ĞĞ’ (Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡) â”‚        â”‚
    â”‚ â”‚ chats_menu_dynamic()    â”‚        â”‚
    â”‚ â”‚                         â”‚        â”‚
    â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
    â”‚ â”‚ â”‚ ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹: [ğŸ“ *]   â”‚  â”‚        â”‚
    â”‚ â”‚ â”‚ ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ: [ğŸ’¬ 2-5]â”‚  â”‚        â”‚
    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
    â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚      â”‚                             â”‚
    â”‚      â–¼                             â”‚
    â”‚  CHAT_ACTIONS                     â”‚
    â”‚  chat_actions_menu_markup()       â”‚
    â”‚  [Ğ’ Ğ§Ğ°Ñ‚] [âœï¸] [ğŸ—‘ï¸] [â†ĞĞ°Ğ·Ğ°Ğ´]    â”‚
    â”‚                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ ĞŸĞ•Ğ Ğ•ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬    â”‚ Ğ Ğ•Ğ”.â”‚ Ğ£Ğ”ĞĞ›Ğ˜Ğ¢Ğ¬      â”‚
     â”‚ confirm_switch â”‚    â”‚ confirm_del  â”‚
     â”‚ [âœ…Ğ”Ğ°][âŒĞÑ‚Ğ¼] â”‚ [?] â”‚ [ğŸ—‘ï¸][âŒĞÑ‚Ğ¼] â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ ĞœĞ•ĞĞ® Ğ¥Ğ ĞĞĞ˜Ğ›Ğ˜Ğ©Ğ Ğ˜ ĞĞĞĞ›Ğ˜Ğ—Ğ       â”‚
                 â”‚ storage_menu_markup()          â”‚
                 â”‚                                â”‚
                 â”‚ [ğŸ“ ĞÑƒĞ´Ğ¸Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ñ‹]              â”‚
                 â”‚ [ğŸ¬ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²ÑŒÑ/Ğ”Ğ¸Ğ·Ğ°Ğ¹Ğ½]          â”‚
                 â”‚ [â† ĞĞ°Ğ·Ğ°Ğ´]                     â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                     â”‚
         â–¼                                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Ğ¤ĞĞ™Ğ›Ğ«        â”‚                  â”‚ Ğ’Ğ«Ğ‘ĞĞ  ĞĞĞĞ›Ğ˜Ğ—Ğâ”‚
    â”‚ view||cat    â”‚                  â”‚              â”‚
    â”‚              â”‚                  â”‚[Ğ˜ĞĞ¢Ğ•Ğ Ğ’Ğ¬Ğ®][Ğ”Ğ˜]
    â”‚[Ğ¤Ğ°Ğ¹Ğ» 1][âŒ]  â”‚                  â”‚[â† ĞĞ°Ğ·Ğ°Ğ´]    â”‚
    â”‚[Ğ¤Ğ°Ğ¹Ğ» 2][âŒ]  â”‚                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚[Ğ—Ğ°Ğ³Ñ€][â† ĞĞ°Ğ·Ğ°Ğ´]                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ Ğ’Ğ«Ğ‘ĞĞ  Ğ¡Ğ¦Ğ•ĞĞĞ Ğ˜Ğ¯    â”‚
                                      â”‚                   â”‚
                                      â”‚ mode_interview    â”‚
                                      â”‚ mode_design       â”‚
                                      â”‚                   â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                             â”‚       â”‚
                                       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                       â”‚ĞĞ¢Ğ§Ğ•Ğ¢Ğ«  â”‚ â”‚ĞĞ¢Ğ§Ğ•Ğ¢Ğ«   â”‚
                                       â”‚Ğ˜ĞĞ¢Ğ•Ğ Ğ’Ğ¬Ğ®â”‚ â”‚Ğ”Ğ˜Ğ—ĞĞ™Ğ   â”‚
                                       â”‚        â”‚ â”‚         â”‚
                                       â”‚[1-5]   â”‚ â”‚[1-3]    â”‚
                                       â”‚[â† ĞĞ°Ğ·Ğ°Ğ´]back]
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Ğ¢Ğ•Ğ¥ĞĞĞ›ĞĞ“Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ Ğ¡Ğ¢Ğ•Ğš Ğ˜ Ğ’Ğ—ĞĞ˜ĞœĞĞ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PYROGRAM LAYER                        â”‚
â”‚  (Telegram Bot Framework)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DECORATORS (Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²)           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ @app.on_callback_query()   â† Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº  â”‚ â”‚
â”‚  â”‚ @app.on_message()          â† Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ‚ĞµĞºÑÑ‚Ğ°  â”‚ â”‚
â”‚  â”‚ @app.on_message(auth_filter) â† Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ HANDLERS (ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸)                        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ callback_query_handler()                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ handle_menu_*()                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ handle_chat_*()                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ handle_report_*()                         â”‚ â”‚
â”‚  â”‚  â””â”€ handle_access_*()                         â”‚ â”‚
â”‚  â”‚                                                â”‚ â”‚
â”‚  â”‚ handle_authorized_text()  â† FSM routing       â”‚ â”‚
â”‚  â”‚ handle_audio_msg()        â† Ğ°ÑƒĞ´Ğ¸Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                 â”‚
        â–¼                                 â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ MESSAGE TRACKER  â”‚         â”‚ MARKUP/KEYBOARDS    â”‚
   â”‚                  â”‚         â”‚                      â”‚
   â”‚ track_and_send() â”‚         â”‚ markups.py          â”‚
   â”‚ _cleanup_by_type â”‚         â”‚ access_markups.py   â”‚
   â”‚ clear_tracked()  â”‚         â”‚                      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                              â”‚
            â”‚                              â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ STATE MANAGEMENT (user_states dict)            â”‚
   â”‚                                                 â”‚
   â”‚ user_states[chat_id] = {                       â”‚
   â”‚   "conversation_id": str,                      â”‚
   â”‚   "step": str,           â† FSM state          â”‚
   â”‚   "data": {...},         â† ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ   â”‚
   â”‚   "deep_search": bool,                        â”‚
   â”‚   ...                                          â”‚
   â”‚ }                                              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. FSM Ğ”Ğ˜ĞĞ“Ğ ĞĞœĞœĞ ĞŸĞ•Ğ Ğ•Ğ¥ĞĞ”ĞĞ’ (Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²ÑŒÑ/Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½)

```
                    START
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ "inputing_      â”‚ â† ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ğ» Ğ°ÑƒĞ´Ğ¸Ğ¾
            â”‚ fields"         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ "ask_audio_number"    â”‚
         â”‚ ask_audio_number()    â”‚ â† Ğ¤Ğ°Ğ·Ğ° ÑĞ±Ğ¾Ñ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ (Ğ²Ğ²ĞµĞ´ĞµĞ½Ğ° Ğ´Ğ°Ñ‚Ğ°)
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ "ask_date"            â”‚
         â”‚ ask_date()            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ (Ğ²Ğ²ĞµĞ´ĞµĞ½Ğ¾ Ğ¸Ğ¼Ñ)
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ "ask_employee"        â”‚
         â”‚ ask_employee()        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ "ask_place_name"      â”‚
         â”‚ ask_place_name()      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ "ask_building_type"   â”‚
         â”‚ ask_building_type()   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ "ask_zone"            â”‚
         â”‚ ask_zone()            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        INTâ”‚            â”‚DES
          â”‚             â”‚
          â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚"ask_     â”‚  â”‚"ask_city"    â”‚
    â”‚client"   â”‚  â”‚ask_city()    â”‚
    â”‚ask_clientâ”‚  â”‚              â”‚
    â”‚()        â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â”‚
         â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ "confirm_data"   â”‚
        â”‚ show_            â”‚ â† ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
        â”‚confirmation_menu â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚
        [âœ…ĞŸĞ¾Ğ´Ñ‚Ğ²]    [âœï¸Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ]
         â”‚               â”‚
         â–¼               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚ ĞÑ‚Ñ‡ĞµÑ‚Ñ‹   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°   â”‚ â”‚ "edit_{field}"  â”‚
    â”‚          â”‚ â”‚ handle_edit_... â”‚
    â”‚[1-5 INT] â”‚ â”‚                 â”‚
    â”‚[1-3 DES] â”‚ â”‚ [ĞĞ¾Ğ²Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡]    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ [â† ĞĞ°Ğ·Ğ°Ğ´]       â”‚
                 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                 [ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ¿Ğ¾Ğ´Ñ‚Ğ²]
                       â”‚
                       â–¼
                [Ğ”Ğ°Ğ»ĞµĞµ EDIT]
```

---

## 4. CALLBACK_DATA ĞœĞĞ Ğ¨Ğ Ğ£Ğ¢Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   callback_query_handler(callback: CallbackQuery) â”‚
â”‚   â†“ callback.data = "..."                        â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â–º "menu_*"          â”€â”€â”€â”€â–º handle_menu_*()
    â”‚   â€¢ menu_main
    â”‚   â€¢ menu_chats
    â”‚   â€¢ menu_system
    â”‚   â€¢ menu_storage
    â”‚   â€¢ menu_help
    â”‚   â€¢ menu_dialog
    â”‚   â€¢ menu_access (super_admin)
    â”‚
    â”œâ”€â–º "new_chat"        â”€â”€â”€â”€â–º handle_new_chat()
    â”‚
    â”œâ”€â–º "chat_actions||*" â”€â”€â”€â”€â–º handle_chat_actions()
    â”œâ”€â–º "confirm_switch||*" â”€â”€â–º handle_switch_chat_confirm()
    â”œâ”€â–º "rename_chat||*"  â”€â”€â”€â”€â–º handle_rename_chat_request()
    â”œâ”€â–º "delete_chat||*"  â”€â”€â”€â”€â–º handle_delete_chat_request()
    â”‚
    â”œâ”€â–º "mode_*"          â”€â”€â”€â”€â–º handle_mode_*()
    â”‚   â€¢ mode_interview
    â”‚   â€¢ mode_design
    â”‚   â€¢ mode_fast
    â”‚   â€¢ mode_deep
    â”‚
    â”œâ”€â–º "report_*"        â”€â”€â”€â”€â–º handle_report()
    â”‚   â€¢ report_int_methodology
    â”‚   â€¢ report_int_links
    â”‚   â€¢ report_design_*
    â”‚   â€¢ send_report||*
    â”‚
    â”œâ”€â–º "view||*"         â”€â”€â”€â”€â–º handle_view_files()
    â”œâ”€â–º "select||*"       â”€â”€â”€â”€â–º handle_file_selection()
    â”œâ”€â–º "delete||*"       â”€â”€â”€â”€â–º handle_file_deletion()
    â”œâ”€â–º "upload||*"       â”€â”€â”€â”€â–º file_upload_handler()
    â”‚
    â”œâ”€â–º "confirm_data"    â”€â”€â”€â”€â–º handle_confirm_data()
    â”œâ”€â–º "edit_data"       â”€â”€â”€â”€â–º show_edit_menu()
    â”œâ”€â–º "edit_*"          â”€â”€â”€â”€â–º handle_edit_field()
    â”‚
    â”œâ”€â–º "show_stats"      â”€â”€â”€â”€â–º handle_show_stats()
    â”œâ”€â–º "show_my_reports" â”€â”€â”€â”€â–º handle_show_my_reports()
    â”‚
    â”œâ”€â–º "report_view"     â”€â”€â”€â”€â–º handle_report_view_request()
    â”œâ”€â–º "report_rename"   â”€â”€â”€â”€â–º handle_report_rename_request()
    â”œâ”€â–º "report_delete"   â”€â”€â”€â”€â–º handle_report_delete_request()
    â”‚
    â”œâ”€â–º "access_*"        â”€â”€â”€â”€â–º handle_access_*()
    â”‚   (50+ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼)
    â”‚
    â””â”€â–º [Ğ¸Ğ½Ñ‹Ğµ]            â”€â”€â”€â”€â–º [Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ]
```

---

## 5. Ğ ĞĞ¡ĞŸĞĞ›ĞĞ–Ğ•ĞĞ˜Ğ• ĞšĞĞœĞŸĞĞĞ•ĞĞ¢ĞĞ’ ĞŸĞ Ğ¤ĞĞ™Ğ›ĞĞœ

```
src/
â”œâ”€â”€ bot.py
â”‚   â””â”€ register_handlers()
â”‚      â”œâ”€ @app.on_message(filters.command("start"))
â”‚      â”œâ”€ @app.on_message(filters.text & auth_filter)
â”‚      â”œâ”€ @app.on_message(filters.voice|audio)
â”‚      â”œâ”€ @app.on_message(filters.document)
â”‚      â””â”€ @app.on_callback_query()
â”‚         â””â”€ callback_query_handler()
â”‚
â”œâ”€â”€ handlers.py
â”‚   â”œâ”€ callback_query_handler() â† Ğ“Ğ›ĞĞ’ĞĞ«Ğ™ ROUTER
â”‚   â”œâ”€ handle_main_menu()
â”‚   â”œâ”€ handle_menu_*()
â”‚   â”œâ”€ handle_chat_*()
â”‚   â”œâ”€ handle_report*()
â”‚   â”œâ”€ handle_authorized_text() â† FSM handler
â”‚   â”œâ”€ handle_edit_field()
â”‚   â”œâ”€ handle_mode_*()
â”‚   â”œâ”€ handle_confirm_data()
â”‚   â””â”€ run_analysis_with_spinner()
â”‚
â”œâ”€â”€ conversation_handlers.py
â”‚   â”œâ”€ ensure_active_conversation()
â”‚   â”œâ”€ handle_new_chat()
â”‚   â”œâ”€ handle_chat_actions()
â”‚   â”œâ”€ handle_switch_chat_confirm()
â”‚   â”œâ”€ handle_rename_chat_request()
â”‚   â”œâ”€ handle_rename_chat_input()
â”‚   â”œâ”€ handle_delete_chat_request()
â”‚   â””â”€ handle_delete_chat_confirm()
â”‚
â”œâ”€â”€ handlers_my_reports_v2.py
â”‚   â”œâ”€ handle_my_reports_v2()
â”‚   â”œâ”€ handle_report_view_request()
â”‚   â”œâ”€ handle_report_view_input()
â”‚   â”œâ”€ handle_report_rename_request()
â”‚   â”œâ”€ handle_report_rename_number_input()
â”‚   â”œâ”€ handle_report_rename_name_input()
â”‚   â”œâ”€ handle_report_delete_request()
â”‚   â”œâ”€ handle_report_delete_input()
â”‚   â””â”€ handle_report_delete_confirm()
â”‚
â”œâ”€â”€ access_handlers.py
â”‚   â”œâ”€ handle_access_menu()
â”‚   â”œâ”€ handle_users_menu()
â”‚   â”œâ”€ handle_list_users()
â”‚   â”œâ”€ handle_user_details()
â”‚   â”œâ”€ handle_change_role()
â”‚   â”œâ”€ handle_invitations_menu()
â”‚   â”œâ”€ handle_security_menu()
â”‚   â””â”€ [40+ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹]
â”‚
â”œâ”€â”€ markups.py
â”‚   â”œâ”€ main_menu_markup()
â”‚   â”œâ”€ system_menu_markup()
â”‚   â”œâ”€ chats_menu_markup_dynamic()
â”‚   â”œâ”€ chat_actions_menu_markup()
â”‚   â”œâ”€ interview_menu_markup()
â”‚   â”œâ”€ design_menu_markup()
â”‚   â”œâ”€ make_dialog_markup()
â”‚   â”œâ”€ confirm_menu_markup()
â”‚   â”œâ”€ edit_menu_markup()
â”‚   â””â”€ [10+ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹]
â”‚
â”œâ”€â”€ access_markups.py
â”‚   â”œâ”€ access_main_menu_markup()
â”‚   â”œâ”€ access_users_menu_markup()
â”‚   â”œâ”€ access_user_list_markup()
â”‚   â”œâ”€ access_user_details_markup()
â”‚   â”œâ”€ access_edit_user_markup()
â”‚   â”œâ”€ access_change_role_markup()
â”‚   â”œâ”€ access_invitations_menu_markup()
â”‚   â””â”€ [10+ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹]
â”‚
â”œâ”€â”€ message_tracker.py (MessageTracker class)
â”‚   â”œâ”€ track_and_send()
â”‚   â”œâ”€ _cleanup_by_type()
â”‚   â”œâ”€ clear_tracked_messages()
â”‚   â””â”€ TrackedMessage dataclass
â”‚
â”œâ”€â”€ menu_manager.py âš ï¸ Ğ£Ğ¡Ğ¢ĞĞ Ğ•Ğ›
â”‚   â”œâ”€ MenuManager class (use MessageTracker instead)
â”‚   â””â”€ send_menu() [wrapper for MessageTracker]
â”‚
â”œâ”€â”€ menus.py
â”‚   â”œâ”€ send_main_menu()
â”‚   â”œâ”€ show_confirmation_menu()
â”‚   â”œâ”€ show_edit_menu()
â”‚   â””â”€ files_menu_markup()
â”‚
â”œâ”€â”€ config.py
â”‚   â”œâ”€ processed_texts: dict
â”‚   â”œâ”€ user_states: dict â† FSM STATE
â”‚   â”œâ”€ STORAGE_DIRS: dict
â”‚   â””â”€ get_auth_manager()
â”‚
â”œâ”€â”€ constants.py
â”‚   â”œâ”€ BUTTON_BACK
â”‚   â”œâ”€ BUTTON_BACK_WITH_ARROW
â”‚   â”œâ”€ COMMAND_HISTORY
â”‚   â”œâ”€ COMMAND_STATS
â”‚   â””â”€ COMMAND_REPORTS
â”‚
â”œâ”€â”€ datamodels.py
â”‚   â”œâ”€ REPORT_MAPPING
â”‚   â”œâ”€ mapping_scenario_names
â”‚   â””â”€ mapping_building_names
â”‚
â”œâ”€â”€ auth_filters.py
â”‚   â””â”€ auth_filter â† Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ  Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
â”‚
â””â”€ [Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹...]
```

---

## 6. ĞŸĞĞ¢ĞĞš Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ¯: ĞÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğº Ğ¼ĞµĞ½Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ² Telegram             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Pyrogram Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚         â”‚
        â”‚ CallbackQuery Ñ callback  â”‚
        â”‚ query.data = "menu_chats" â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ @app.on_callback_query()  â”‚
        â”‚ Ğ´ĞµĞºĞ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€ ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ callback_query_handler()        â”‚
        â”‚ (handlers.py Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ router)   â”‚
        â”‚                                â”‚
        â”‚ if data == "menu_chats":       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ await handle_menu_chats()      â”‚
        â”‚ (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ chat_id Ğ¸Ğ· callback) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ conversation_manager.list_...() â”‚
        â”‚ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‡Ğ°Ñ‚Ğ¾Ğ² ÑĞ·ĞµÑ€Ğ°    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ chats_menu_markup_dynamic()    â”‚
        â”‚ (markups.py)                   â”‚
        â”‚ Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ InlineKeyboard      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ await track_and_send()           â”‚
        â”‚ (message_tracker.py)             â”‚
        â”‚ - ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ¼ĞµĞ½Ñ            â”‚
        â”‚ - ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¼ĞµĞ½Ñ          â”‚
        â”‚ - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² tracking dict      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ app.send_message(                â”‚
        â”‚   chat_id,                       â”‚
        â”‚   text="...",                    â”‚
        â”‚   reply_markup=keyboard          â”‚
        â”‚ )                                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸ Ğ¿Ğ¾ÑĞ²Ğ»ÑĞµÑ‚ÑÑ  â”‚
        â”‚ Ğ² Ñ‡Ğ°Ñ‚Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğ° Telegram  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ĞšĞ›Ğ®Ğ§Ğ•Ğ’Ğ«Ğ• ĞĞ‘ĞªĞ•ĞšĞ¢Ğ« Ğ˜ Ğ¢Ğ˜ĞŸĞ« Ğ”ĞĞĞĞ«Ğ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ InlineKeyboardMarkup (Pyrogram)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [[button1, button2],                    â”‚
â”‚  [button3],                             â”‚
â”‚  [button4, button5, button6]]           â”‚
â”‚                                         â”‚
â”‚ Ğ“Ğ´Ğµ button = InlineKeyboardButton:      â”‚
â”‚   â”œâ”€ text: str (Ñ‚ĞµĞºÑÑ‚ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞµ)       â”‚
â”‚   â”œâ”€ callback_data: str (Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ñ)
â”‚   â”œâ”€ url: Optional[str] (ÑÑÑ‹Ğ»ĞºĞ°)       â”‚
â”‚   â””â”€ ...                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CallbackQuery (Pyrogram)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                       â”‚
â”‚   id: str,                              â”‚
â”‚   from_user: User,                      â”‚
â”‚   chat_instance: str,                   â”‚
â”‚   message: Message,                     â”‚
â”‚   data: str = "menu_chats",             â”‚
â”‚   inline_message_id: Optional[str],     â”‚
â”‚   game_short_name: Optional[str]        â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TrackedMessage (message_tracker.py)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ @dataclass                              â”‚
â”‚ class TrackedMessage:                   â”‚
â”‚   message_id: int                       â”‚
â”‚   message_type: MessageType             â”‚
â”‚   timestamp: datetime                   â”‚
â”‚   has_buttons: bool                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConversationMetadata                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ {                                       â”‚
â”‚   title: str,                           â”‚
â”‚   created_at: str,                      â”‚
â”‚   updated_at: str,                      â”‚
â”‚   is_active: bool,                      â”‚
â”‚   message_count: int,                   â”‚
â”‚   total_tokens: int,                    â”‚
â”‚   chat_number: int                      â”‚
â”‚ }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ«Ğ• ĞœĞ•Ğ¡Ğ¢Ğ Ğ˜ĞĞ¢Ğ•Ğ“Ğ ĞĞ¦Ğ˜Ğ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Ğ Ğ•Ğ“Ğ˜Ğ¡Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯ ĞĞ‘Ğ ĞĞ‘ĞĞ¢Ğ§Ğ˜ĞšĞĞ’         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ bot.py â†’ register_handlers()        â”‚
â”‚ ĞœĞµÑÑ‚Ğ¾: ĞºĞ¾Ğ½ĞµÑ† Ñ„Ğ°Ğ¹Ğ»Ğ° main()           â”‚
â”‚                                     â”‚
â”‚ Ğ”ĞĞ‘ĞĞ’Ğ˜Ğ¢Ğ¬ ĞĞĞ’Ğ«Ğ™ CALLBACK:            â”‚
â”‚ @app.on_callback_query()            â”‚
â”‚ elif data == "new_pattern":         â”‚
â”‚     await handle_new_pattern()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Ğ¡ĞĞ—Ğ”ĞĞĞ˜Ğ• ĞĞĞ’ĞĞ“Ğ ĞœĞ•ĞĞ®            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ markups.py â†’ Ğ½Ğ¾Ğ²Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ          â”‚
â”‚                                     â”‚
â”‚ def new_menu_markup() -> ...:       â”‚
â”‚   return InlineKeyboardMarkup([...])â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ĞĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ• HANDLER Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handlers.py â†’ Ğ½Ğ¾Ğ²Ğ°Ñ async Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ   â”‚
â”‚                                     â”‚
â”‚ async def handle_new_action(...):   â”‚
â”‚   ... Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ...                    â”‚
â”‚   await track_and_send(...)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. FSM ĞŸĞ•Ğ Ğ•Ğ¥ĞĞ”Ğ«                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handlers.py â†’ handle_authorized_textâ”‚
â”‚ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ step Ğ² if/elif       â”‚
â”‚                                     â”‚
â”‚ if step == "new_step":              â”‚
â”‚   ... Ñ‚ĞµĞºÑÑ‚ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ Ğ˜ĞĞ¢Ğ•Ğ ĞĞšĞ¢Ğ˜Ğ’ĞĞ«Ğ¥ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ĞĞ’ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ message_tracker.py â†’ track_and_send â”‚
â”‚ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚    â”‚
â”‚ message_type Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°              â”‚
â”‚                                     â”‚
â”‚ message_type="menu"     â†’ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚   â”‚
â”‚ message_type="input"    â†’ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚   â”‚
â”‚ message_type="confirm"  â†’ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚   â”‚
â”‚ message_type="status"   â†’ Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚   â”‚
â”‚ message_type="info"     â†’ ĞĞ• Ğ¾Ñ‡Ğ¸ÑÑ‚Ğ¸Ñ‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ—ĞĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ•

ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¼ĞµĞ½Ñ ÑĞ»ĞµĞ´ÑƒĞµÑ‚ ĞºĞ»Ğ°ÑÑĞ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ñ‚Ñ€ĞµÑ…ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğµ:

1. **UI Ğ¡Ğ»Ğ¾Ğ¹** (markups.py) - Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½ Ğ¸ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº
2. **Logic Ğ¡Ğ»Ğ¾Ğ¹** (handlers.py) - Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ğ¸ FSM
3. **Tracking Ğ¡Ğ»Ğ¾Ğ¹** (message_tracker.py) - ÑƒĞ¼Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼

Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ñ‹ Ğ¿Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ»ĞµĞ³ĞºĞ¾ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ñ‹.

