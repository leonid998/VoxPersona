# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö VoxPersona: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π –∏ –æ—Ç—á–µ—Ç–æ–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL 14
**–ù–∞–∑–≤–∞–Ω–∏–µ –ë–î:** `bot_db`

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#–æ–±—â–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)
3. [–û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü](#–æ–ø–∏—Å–∞–Ω–∏–µ-—Ç–∞–±–ª–∏—Ü)
4. [–°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏](#—Å–≤—è–∑–∏-–º–µ–∂–¥—É-—Ç–∞–±–ª–∏—Ü–∞–º–∏)
5. [–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: –ò–Ω—Ç–µ—Ä–≤—å—é vs –î–∏–∑–∞–π–Ω](#—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤-–∏–Ω—Ç–µ—Ä–≤—å—é-vs-–¥–∏–∑–∞–π–Ω)
6. [–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫-–¥–∞–Ω–Ω—ã—Ö)
7. [–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤](#—Å–æ–∑–¥–∞–Ω–∏–µ-–∏–Ω–¥–µ–∫—Å–æ–≤)
8. [–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞-–¥–∞–Ω–Ω—ã—Ö)
9. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
10. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–¥–ª—è-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

---

## üóÇÔ∏è –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:** `voxpersona_postgres`

```bash
# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∏–∑ .env)
DB_NAME=bot_db
DB_USER=voxpersona_user
DB_PASSWORD=voxpersona_password
DB_HOST=postgres
DB_PORT=5432

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Docker
docker exec voxpersona_postgres psql -U voxpersona_user -d bot_db

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —Ö–æ—Å—Ç–∞
psql -h localhost -p 5432 -U voxpersona_user -d bot_db
```

### –§–∏–∑–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

- **–¢–æ–º Docker:** `postgres_data`
- **–ü—É—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:** `/var/lib/postgresql/data`
- **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ß–µ—Ä–µ–∑ docker-compose volume

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Audio Files    ‚îÇ (MinIO: voxpersona-audio bucket)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ TRANSCRIPTION   ‚îÇ ‚óÑ‚îÄ‚îÄ‚îê –ò—Å—Ö–æ–¥–Ω—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
         ‚îÇ             ‚îÇ
         ‚ñº             ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ     AUDIT       ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îò –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã (—Å–≤—è–∑–∞–Ω—ã —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–µ–π)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   USER_ROAD     ‚îÇ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è: —Å–≤—è–∑—å –æ—Ç—á–µ—Ç–æ–≤ —Å —Ç–∏–ø–∞–º–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇSCENARIO ‚îÇ ‚îÇ REPORT_TYPE  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü

### 1. –¢–∞–±–ª–∏—Ü–∞ `transcription` - –ò—Å—Ö–æ–¥–Ω—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–µ–π (–∏–Ω—Ç–µ—Ä–≤—å—é –∏ –∞—É–¥–∏—Ç–æ–≤).

| –ö–æ–ª–æ–Ω–∫–∞             | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö                  | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|---------------------|----------------------------|--------------|---------------------------------------------|
| `transcription_id`  | `INTEGER`                  | ‚úÖ (PK)      | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç) |
| `transcription_text`| `TEXT`                     | ‚ùå           | –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã) |
| `audio_file_name`   | `VARCHAR(255)`             | ‚ùå           | –ò–º—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞                    |
| `transcription_date`| `TIMESTAMP WITHOUT TZ`     | ‚ùå           | –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏         |
| `number_audio`      | `INTEGER`                  | ‚ùå           | –ù–æ–º–µ—Ä –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–∏                           |

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∏–ø `TEXT` –¥–ª—è `transcription_text` - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—É—é –¥–ª–∏–Ω—É
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏: 25,000-200,000 —Å–∏–º–≤–æ–ª–æ–≤
- –û–¥–∏–Ω –∞—É–¥–∏–æ—Ñ–∞–π–ª –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π (—Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏)

**–ò–Ω–¥–µ–∫—Å—ã:**
- `transcription_pkey` - PRIMARY KEY –Ω–∞ `transcription_id`

---

### 2. –¢–∞–±–ª–∏—Ü–∞ `audit` - –û—Ç—á–µ—Ç—ã –∏ –∞—É–¥–∏—Ç—ã

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π.

| –ö–æ–ª–æ–Ω–∫–∞             | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|---------------------|---------------|--------------|---------------------------------------------|
| `audit_id`          | `INTEGER`     | ‚úÖ (PK)      | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –æ—Ç—á–µ—Ç–∞ (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)       |
| `audit`             | `TEXT`        | ‚ùå           | –¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞/–∞—É–¥–∏—Ç–∞                         |
| `employee_id`       | `INTEGER`     | ‚ùå (FK)      | –°–≤—è–∑—å —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º (–∫—Ç–æ –ø—Ä–æ–≤–æ–¥–∏–ª)          |
| `client_id`         | `INTEGER`     | ‚ùå (FK)      | –°–≤—è–∑—å —Å –∫–ª–∏–µ–Ω—Ç–æ–º                            |
| `place_id`          | `INTEGER`     | ‚ùå (FK)      | –°–≤—è–∑—å —Å –º–µ—Å—Ç–æ–º (–æ–±—ä–µ–∫—Ç–æ–º)                   |
| `audit_date`        | `DATE`        | ‚ùå           | –î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏—Ç–∞                      |
| `city_id`           | `INTEGER`     | ‚ùå (FK)      | –°–≤—è–∑—å —Å –≥–æ—Ä–æ–¥–æ–º                             |
| `transcription_id`  | `INTEGER`     | ‚ùå (FK)      | –°–≤—è–∑—å —Å –∏—Å—Ö–æ–¥–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–µ–π             |

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–¥–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç—á–µ—Ç–æ–≤** —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
- –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ –æ—Ç—á–µ—Ç–∞: 6,000-13,000 —Å–∏–º–≤–æ–ª–æ–≤
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—á–µ—Ç—ã –∫–æ—Ä–æ—Ç–∫–∏–µ (JSON —Å –æ—Ü–µ–Ω–∫–∞–º–∏) - 40-300 —Å–∏–º–≤–æ–ª–æ–≤

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏:**
- `audit_transcription_id_fkey` ‚Üí `transcription(transcription_id)` ON UPDATE CASCADE ON DELETE SET NULL
- `audit_employee_id_fkey` ‚Üí `employee(employee_id)` ON UPDATE CASCADE ON DELETE SET NULL
- `audit_client_id_fkey` ‚Üí `client(client_id)` ON UPDATE CASCADE ON DELETE SET NULL
- `audit_place_id_fkey` ‚Üí `place(place_id)` ON UPDATE CASCADE ON DELETE SET NULL
- `audit_city_id_fkey` ‚Üí `city(city_id)` ON UPDATE CASCADE ON DELETE SET NULL

**–ò–Ω–¥–µ–∫—Å—ã:**
- `audit_pkey` - PRIMARY KEY –Ω–∞ `audit_id`

---

### 3. –¢–∞–±–ª–∏—Ü–∞ `scenario` - –¢–∏–ø—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ **–ò–Ω—Ç–µ—Ä–≤—å—é** –∏ **–î–∏–∑–∞–π–Ω** (–∞—É–¥–∏—Ç).

| –ö–æ–ª–æ–Ω–∫–∞         | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|-----------------|---------------|--------------|---------------------------------------------|
| `scenario_id`   | `INTEGER`     | ‚úÖ (PK)      | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å—Ü–µ–Ω–∞—Ä–∏—è (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)      |
| `scenario_name` | `VARCHAR(255)`| ‚ùå           | –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è                           |

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

| scenario_id | scenario_name |
|-------------|---------------|
| 1           | –ò–Ω—Ç–µ—Ä–≤—å—é      |
| 2           | –î–∏–∑–∞–π–Ω        |

**–ò–Ω–¥–µ–∫—Å—ã:**
- `scenario_pkey` - PRIMARY KEY –Ω–∞ `scenario_id`

---

### 4. –¢–∞–±–ª–∏—Ü–∞ `report_type` - –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è.

| –ö–æ–ª–æ–Ω–∫–∞             | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|---------------------|---------------|--------------|---------------------------------------------|
| `report_type_id`    | `INTEGER`     | ‚úÖ (PK)      | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–∞ (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)  |
| `report_type_desc`  | `VARCHAR(255)`| ‚ùå           | –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–∞                        |
| `scenario_id`       | `INTEGER`     | ‚úÖ (FK)      | –°–≤—è–∑—å —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º                          |

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤:**

#### –°—Ü–µ–Ω–∞—Ä–∏–π "–ò–Ω—Ç–µ—Ä–≤—å—é" (scenario_id = 1):

| report_type_id | report_type_desc              |
|----------------|-------------------------------|
| 1              | –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é   |
| 2              | –û—Ç—á–µ—Ç –æ —Å–≤—è–∑–∫–∞—Ö               |
| 3              | –§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏      |
| 4              | –û–±—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã                 |

#### –°—Ü–µ–Ω–∞—Ä–∏–π "–î–∏–∑–∞–π–Ω" (scenario_id = 2):

| report_type_id | report_type_desc                 |
|----------------|----------------------------------|
| 5              | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∞—É–¥–∏—Ç–∞    |
| 6              | –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∞—É–¥–∏—Ç–∞        |
| 7              | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞   |

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏:**
- `report_type_scenario_id_fkey` ‚Üí `scenario(scenario_id)` ON UPDATE CASCADE ON DELETE CASCADE

**–ò–Ω–¥–µ–∫—Å—ã:**
- `report_type_pkey` - PRIMARY KEY –Ω–∞ `report_type_id`

---

### 5. –¢–∞–±–ª–∏—Ü–∞ `user_road` - –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤—è–∑—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –æ—Ç—á–µ—Ç–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–∏–ø—É –∏ —Å—Ü–µ–Ω–∞—Ä–∏—é.

| –ö–æ–ª–æ–Ω–∫–∞             | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
|---------------------|-----------|--------------|---------------------------------------------|
| `user_road_id`      | `INTEGER` | ‚úÖ (PK)      | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–ø–∏—Å–∏ (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)        |
| `audit_id`          | `INTEGER` | ‚úÖ (FK)      | –°–≤—è–∑—å —Å –æ—Ç—á–µ—Ç–æ–º                             |
| `scenario_id`       | `INTEGER` | ‚úÖ (FK)      | –°–≤—è–∑—å —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º (–ò–Ω—Ç–µ—Ä–≤—å—é/–î–∏–∑–∞–π–Ω)        |
| `report_type_id`    | `INTEGER` | ‚úÖ (FK)      | –°–≤—è–∑—å —Å —Ç–∏–ø–æ–º –æ—Ç—á–µ—Ç–∞                        |
| `building_id`       | `INTEGER` | ‚úÖ (FK)      | –°–≤—è–∑—å —Å –æ–±—ä–µ–∫—Ç–æ–º (–∑–¥–∞–Ω–∏–µ–º)                  |

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞** –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ - —Å–≤—è–∑—ã–≤–∞–µ—Ç –æ—Ç—á–µ—Ç—ã —Å –∏—Ö –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- –û–¥–∏–Ω –æ—Ç—á–µ—Ç (`audit_id`) –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞
- –ß–µ—Ä–µ–∑ —ç—Ç—É —Ç–∞–±–ª–∏—Ü—É –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è, –∫ –∫–∞–∫–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –æ—Ç—á–µ—Ç

**–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏:**
- `user_road_audit_id_fkey` ‚Üí `audit(audit_id)` ON UPDATE CASCADE ON DELETE CASCADE
- `user_road_scenario_id_fkey` ‚Üí `scenario(scenario_id)` ON UPDATE CASCADE ON DELETE CASCADE

**–ò–Ω–¥–µ–∫—Å—ã:**
- `user_road_pkey` - PRIMARY KEY –Ω–∞ `user_road_id`

#### üîç –ß—Ç–æ —Ç–∞–∫–æ–µ USER_ROAD –∏ –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç?

**USER_ROAD** - —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–µ–¥–∏–Ω—è–µ—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –æ—Ç—á–µ—Ç–∞:

1. **–ö–∞–∫–æ–π —ç—Ç–æ –æ—Ç—á–µ—Ç?** ‚Üí `audit_id` (—Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ—Ç—á–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `audit`)
2. **–ö –∫–∞–∫–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é –æ—Ç–Ω–æ—Å–∏—Ç—Å—è?** ‚Üí `scenario_id` (1 = –ò–Ω—Ç–µ—Ä–≤—å—é, 2 = –î–∏–∑–∞–π–Ω)
3. **–ö–∞–∫–æ–π —Ç–∏–ø –æ—Ç—á–µ—Ç–∞?** ‚Üí `report_type_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é")
4. **–î–ª—è –∫–∞–∫–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞?** ‚Üí `building_id` (—Ä–µ—Å—Ç–æ—Ä–∞–Ω, –æ—Ç–µ–ª—å, —Å–ø–∞ –∏ —Ç.–¥.)

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é –ø—Ä–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω "–ë—É—Ä–±–æ–Ω". –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–ª—è –Ω–µ—ë 4 —Ä–∞–∑–Ω—ã—Ö –æ—Ç—á–µ—Ç–∞:
- –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é (—Ç–µ–∫—Å—Ç–æ–≤—ã–π)
- –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é (JSON —Å –æ—Ü–µ–Ω–∫–∞–º–∏)
- –§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏ (—Ç–µ–∫—Å—Ç–æ–≤—ã–π)
- –§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏ (JSON —Å –æ—Ü–µ–Ω–∫–∞–º–∏)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö 4 –æ—Ç—á–µ—Ç–æ–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ `user_road`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–µ—á–∞–µ—Ç:
```
–û—Ç—á–µ—Ç #9460 ‚Üí –°—Ü–µ–Ω–∞—Ä–∏–π "–ò–Ω—Ç–µ—Ä–≤—å—é" ‚Üí –¢–∏–ø "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏" ‚Üí –ó–¥–∞–Ω–∏–µ "–†–µ—Å—Ç–æ—Ä–∞–Ω"
–û—Ç—á–µ—Ç #9461 ‚Üí –°—Ü–µ–Ω–∞—Ä–∏–π "–ò–Ω—Ç–µ—Ä–≤—å—é" ‚Üí –¢–∏–ø "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏" ‚Üí –ó–¥–∞–Ω–∏–µ "–†–µ—Å—Ç–æ—Ä–∞–Ω"
–û—Ç—á–µ—Ç #9462 ‚Üí –°—Ü–µ–Ω–∞—Ä–∏–π "–ò–Ω—Ç–µ—Ä–≤—å—é" ‚Üí –¢–∏–ø "–§–∞–∫—Ç–æ—Ä—ã –≤ –∑–∞–≤–µ–¥–µ–Ω–∏–∏" ‚Üí –ó–¥–∞–Ω–∏–µ "–†–µ—Å—Ç–æ—Ä–∞–Ω"
–û—Ç—á–µ—Ç #9463 ‚Üí –°—Ü–µ–Ω–∞—Ä–∏–π "–ò–Ω—Ç–µ—Ä–≤—å—é" ‚Üí –¢–∏–ø "–§–∞–∫—Ç–æ—Ä—ã –≤ –∑–∞–≤–µ–¥–µ–Ω–∏–∏" ‚Üí –ó–¥–∞–Ω–∏–µ "–†–µ—Å—Ç–æ—Ä–∞–Ω"
```

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?**

–ë–µ–∑ `user_road` –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
- –°–∫–æ–ª—å–∫–æ –æ—Ç—á–µ—Ç–æ–≤ —Ç–∏–ø–∞ "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é" –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ?
- –ö–∞–∫–∏–µ –æ—Ç—á–µ—Ç—ã –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Å—Ü–µ–Ω–∞—Ä–∏—é "–î–∏–∑–∞–π–Ω"?
- –î–ª—è –∫–∞–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤/–æ—Ç–µ–ª–µ–π) —Å–æ–∑–¥–∞–Ω—ã –æ—Ç—á–µ—Ç—ã?

**–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```sql
-- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç—á–µ—Ç—ã –ø–æ –ò–Ω—Ç–µ—Ä–≤—å—é –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–¥–∞–Ω–∏—è
SELECT a.audit, rt.report_type_desc
FROM audit a
JOIN user_road ur ON a.audit_id = ur.audit_id
JOIN report_type rt ON ur.report_type_id = rt.report_type_id
WHERE ur.scenario_id = 1 AND ur.building_id = 5;
```

**–í–∞–∂–Ω–æ:** –ö–∞–∂–¥—ã–π –æ—Ç—á–µ—Ç (`audit_id`) –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –≤ `user_road` - –æ–¥–∏–Ω –æ—Ç—á–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∏ –∫ "–ò–Ω—Ç–µ—Ä–≤—å—é" –∏ –∫ "–î–∏–∑–∞–π–Ω". –≠—Ç–æ –∂—ë—Å—Ç–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è.

---

### 6. –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

#### –¢–∞–±–ª–∏—Ü–∞ `employee` - –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏

| –ö–æ–ª–æ–Ω–∫–∞         | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–ø–∏—Å–∞–Ω–∏–µ                  |
|-----------------|---------------|---------------------------|
| `employee_id`   | `INTEGER` (PK)| ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞             |
| `employee_name` | `VARCHAR(255)`| –ò–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞            |

**–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:** 34 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞

---

#### –¢–∞–±–ª–∏—Ü–∞ `client` - –ö–ª–∏–µ–Ω—Ç—ã

| –ö–æ–ª–æ–Ω–∫–∞       | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–ø–∏—Å–∞–Ω–∏–µ          |
|---------------|---------------|-------------------|
| `client_id`   | `INTEGER` (PK)| ID –∫–ª–∏–µ–Ω—Ç–∞        |
| `client_name` | `VARCHAR(255)`| –ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞  |

**–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:** 392 –∫–ª–∏–µ–Ω—Ç–∞

---

#### –¢–∞–±–ª–∏—Ü–∞ `place` - –ú–µ—Å—Ç–∞/–û–±—ä–µ–∫—Ç—ã

| –ö–æ–ª–æ–Ω–∫–∞         | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–ø–∏—Å–∞–Ω–∏–µ                  |
|-----------------|---------------|---------------------------|
| `place_id`      | `INTEGER` (PK)| ID –º–µ—Å—Ç–∞                  |
| `place_name`    | `VARCHAR(255)`| –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞            |
| `building_type` | `VARCHAR(255)`| –¢–∏–ø –∑–¥–∞–Ω–∏—è                |

**–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:** 189 –º–µ—Å—Ç (—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, –æ—Ç–µ–ª–∏, —Å–ø–∞-—Ü–µ–Ω—Ç—Ä—ã –∏ —Ç.–¥.)

---

#### –¢–∞–±–ª–∏—Ü–∞ `city` - –ì–æ—Ä–æ–¥–∞

| –ö–æ–ª–æ–Ω–∫–∞     | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–ø–∏—Å–∞–Ω–∏–µ       |
|-------------|---------------|----------------|
| `city_id`   | `INTEGER` (PK)| ID –≥–æ—Ä–æ–¥–∞      |
| `city_name` | `VARCHAR(255)`| –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞|

**–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:** 5 –≥–æ—Ä–æ–¥–æ–≤

---

#### –¢–∞–±–ª–∏—Ü–∞ `buildings` - –ó–¥–∞–Ω–∏—è

| –ö–æ–ª–æ–Ω–∫–∞         | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö     | –û–ø–∏—Å–∞–Ω–∏–µ       |
|-----------------|---------------|----------------|
| `building_id`   | `INTEGER` (PK)| ID –∑–¥–∞–Ω–∏—è      |
| `building_type` | `VARCHAR(255)`| –¢–∏–ø –∑–¥–∞–Ω–∏—è     |

---

## üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

### –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π (ER-–¥–∏–∞–≥—Ä–∞–º–º–∞)

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   SCENARIO   ‚îÇ
                    ‚îÇ  (2 –∑–∞–ø–∏—Å–∏)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ 1
                           ‚îÇ
                           ‚îÇ N
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ REPORT_TYPE  ‚îÇ
                    ‚îÇ  (7 –∑–∞–ø–∏—Å–µ–π) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚îÇ N                ‚îÇ 1                ‚îÇ N
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   USER_ROAD    ‚îÇ  ‚îÇ     AUDIT    ‚îÇ  ‚îÇ TRANSCRIPTION ‚îÇ
‚îÇ (9,434 –∑–∞–ø–∏—Å–∏) ‚îÇ‚óÑ‚îÄ‚î§(9,461 –∑–∞–ø–∏—Å—å)‚îÇ‚óÑ‚îÄ‚î§(1,147 –∑–∞–ø–∏—Å–µ–π)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò1 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îòN ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                  ‚îÇ
        ‚îÇ                  ‚îÇ
        ‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ          ‚îÇ       ‚îÇ       ‚îÇ         ‚îÇ          ‚îÇ
        ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ      ‚îÇEMPLOYEE‚îÇ‚îÇCLIENT‚îÇ‚îÇ PLACE  ‚îÇ‚îÇ  CITY  ‚îÇ‚îÇBUILDING‚îÇ
        ‚îÇ      ‚îÇ  (34) ‚îÇ‚îÇ(392)‚îÇ‚îÇ  (189) ‚îÇ‚îÇ   (5)  ‚îÇ‚îÇ        ‚îÇ
        ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ BUILDING
```

### –ö–ª—é—á–µ–≤—ã–µ —Å–≤—è–∑–∏

1. **TRANSCRIPTION ‚Üí AUDIT** (1:N)
   - –û–¥–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç—á–µ—Ç–æ–≤
   - –°–≤—è–∑—å: `audit.transcription_id` ‚Üí `transcription.transcription_id`

2. **AUDIT ‚Üí USER_ROAD** (1:N)
   - –û–¥–∏–Ω –æ—Ç—á–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–∞–ø–∏—Å—è–º–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
   - –°–≤—è–∑—å: `user_road.audit_id` ‚Üí `audit.audit_id`

3. **SCENARIO ‚Üí REPORT_TYPE** (1:N)
   - –û–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –æ—Ç—á–µ—Ç–æ–≤
   - –°–≤—è–∑—å: `report_type.scenario_id` ‚Üí `scenario.scenario_id`

4. **USER_ROAD ‚Üí SCENARIO** (N:1)
   - –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–≤—è–∑—ã–≤–∞–µ—Ç –æ—Ç—á–µ—Ç —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º
   - –°–≤—è–∑—å: `user_road.scenario_id` ‚Üí `scenario.scenario_id`

---

## üéØ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: –ò–Ω—Ç–µ—Ä–≤—å—é vs –î–∏–∑–∞–π–Ω

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

VoxPersona —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–≤—É–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–µ–π:

1. **–ò–Ω—Ç–µ—Ä–≤—å—é** - –∑–∞–ø–∏—Å–∏ –∏–Ω—Ç–µ—Ä–≤—å—é —Å –¥–∏–∑–∞–π–Ω–µ—Ä–∞–º–∏-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è–º–∏, —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏
2. **–î–∏–∑–∞–π–Ω (–ê—É–¥–∏—Ç)** - –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏—Ç–æ–≤ –¥–∏–∑–∞–π–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤ (–æ—Ç–µ–ª–∏, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Å–ø–∞)

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü—ã `scenario`.

### –ü—Ä–æ—Ü–µ—Å—Å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

```
–ê—É–¥–∏–æ—Ñ–∞–π–ª ‚Üí –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ ‚Üí –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ USER_ROAD
                ‚Üì                    ‚Üì                      ‚Üì
         transcription.audio_file   audit.audit      user_road.scenario_id
                                                            ‚Üì
                                                    1 = –ò–Ω—Ç–µ—Ä–≤—å—é
                                                    2 = –î–∏–∑–∞–π–Ω
```

### –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º

#### –°—Ü–µ–Ω–∞—Ä–∏–π "–ò–Ω—Ç–µ—Ä–≤—å—é" (ID = 1)

**–¶–µ–ª—å:** –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤—å—é –∏ –∞–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

| ‚Ññ | –¢–∏–ø –æ—Ç—á–µ—Ç–∞                      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                           |
|---|---------------------------------|------------------------------------------------------|
| 1 | –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é     | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é       |
| 2 | –û—Ç—á–µ—Ç –æ —Å–≤—è–∑–∫–∞—Ö                 | –ê–Ω–∞–ª–∏–∑ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∏–Ω—Ç–µ—Ä–≤—å—é              |
| 3 | –§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏        | –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞        |
| 4 | –û–±—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã                   | –í—ã—è–≤–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ —Ñ–∞–∫—Ç–æ—Ä–æ–≤                 |

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç—á–µ—Ç–∞:**
- –¢–µ–∫—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ + JSON —Å –æ—Ü–µ–Ω–∫–∞–º–∏
- –î–ª–∏–Ω–∞: 40-13,500 —Å–∏–º–≤–æ–ª–æ–≤

---

#### –°—Ü–µ–Ω–∞—Ä–∏–π "–î–∏–∑–∞–π–Ω" (ID = 2)

**–¶–µ–ª—å:** –û—Ü–µ–Ω–∫–∞ –¥–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –∞—É–¥–∏—Ç–∞ –æ–±—ä–µ–∫—Ç–æ–≤.

| ‚Ññ | –¢–∏–ø –æ—Ç—á–µ—Ç–∞                         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                           |
|---|------------------------------------|------------------------------------------------------|
| 5 | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∞—É–¥–∏—Ç–∞      | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã –∞—É–¥–∏—Ç–∞                 |
| 6 | –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∞—É–¥–∏—Ç–∞          | –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏—Ç–∞        |
| 7 | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞     | –ü–æ–ª–Ω—ã–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –æ–±—ä–µ–∫—Ç—É            |

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç—á–µ—Ç–∞:**
- Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏
- JSON —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –î–ª–∏–Ω–∞: 280-7,900 —Å–∏–º–≤–æ–ª–æ–≤

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∏ –æ—Ç—á–µ—Ç–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. –ó–ê–ì–†–£–ó–ö–ê –ê–£–î–ò–û                                               ‚îÇ
‚îÇ     - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞       ‚îÇ
‚îÇ     - –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MinIO (bucket: voxpersona-audio)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. –¢–†–ê–ù–°–ö–†–ò–ë–ê–¶–ò–Ø                                                ‚îÇ
‚îÇ     - –ê—É–¥–∏–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ API —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (Whisper API)      ‚îÇ
‚îÇ     - –ü–æ–ª—É—á–µ–Ω —Ç–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏                                ‚îÇ
‚îÇ     - –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ TRANSCRIPTION                   ‚îÇ
‚îÇ       ‚Ä¢ transcription_text = "–¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏..."            ‚îÇ
‚îÇ       ‚Ä¢ audio_file_name = "2025-04-10-–ë—É—Ä–±–æ–Ω –ö—É–Ω—Ç—ã—à–µ–≤–∞.mp3"      ‚îÇ
‚îÇ       ‚Ä¢ transcription_date = NOW()                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3. –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–ß–ï–¢–û–í                                            ‚îÇ
‚îÇ     - –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è AI –º–æ–¥–µ–ª—å—é (Claude)           ‚îÇ
‚îÇ     - –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –æ—Ç—á–µ—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤                           ‚îÇ
‚îÇ     - –ö–∞–∂–¥—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ AUDIT                   ‚îÇ
‚îÇ       ‚Ä¢ audit = "–¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞..."                                ‚îÇ
‚îÇ       ‚Ä¢ transcription_id = [ID —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏]                    ‚îÇ
‚îÇ       ‚Ä¢ employee_id, place_id, city_id (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4. –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø –ò –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–Ø                                ‚îÇ
‚îÇ     - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç—á–µ—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ USER_ROAD            ‚îÇ
‚îÇ       ‚Ä¢ audit_id = [ID –æ—Ç—á–µ—Ç–∞]                                   ‚îÇ
‚îÇ       ‚Ä¢ scenario_id = 1 (–ò–Ω—Ç–µ—Ä–≤—å—é) –∏–ª–∏ 2 (–î–∏–∑–∞–π–Ω)                ‚îÇ
‚îÇ       ‚Ä¢ report_type_id = [–¢–∏–ø –æ—Ç—á–µ—Ç–∞ 1-7]                        ‚îÇ
‚îÇ       ‚Ä¢ building_id = [ID –∑–¥–∞–Ω–∏—è]                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  5. –ü–†–ï–î–û–°–¢–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–•                                        ‚îÇ
‚îÇ     - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç—á–µ—Ç—ã —á–µ—Ä–µ–∑ –±–æ—Ç–∞                    ‚îÇ
‚îÇ     - –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î –∏—Å–ø–æ–ª—å–∑—É—é—Ç JOIN –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

### –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

VoxPersona –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≤–µ–∫—Ç–æ—Ä–Ω—É—é –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ **FAISS** (Facebook AI Similarity Search) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –æ—Ç—á–µ—Ç–∞–º. –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∏–∑ –¥–∞–Ω–Ω—ã—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram –±–æ—Ç–∞ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏ –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–∑ —Ç—ã—Å—è—á –æ—Ç—á–µ—Ç–æ–≤.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

- **Embedding Model**: `all-MiniLM-L6-v2` –æ—Ç SentenceTransformers (384-—Ä–∞–∑–º–µ—Ä–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã)
- **–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î**: FAISS (Facebook AI Similarity Search)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: LangChain Community (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ FAISS –∏ embeddings)
- **Chunking**: RecursiveCharacterTextSplitter (—Ä–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞: 800 —Å–∏–º–≤–æ–ª–æ–≤, overlap: 100)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. –ò–ó–í–õ–ï–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• –ò–ó PostgreSQL                            ‚îÇ
‚îÇ     ‚Ä¢ –ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ build_reports_grouped()                      ‚îÇ
‚îÇ     ‚Ä¢ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ scenario_name –∏ report_type                 ‚îÇ
‚îÇ     ‚Ä¢ JOIN: transcription ‚Üí audit ‚Üí user_road ‚Üí scenario        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. –ì–†–£–ü–ü–ò–†–û–í–ö–ê –ü–û –¢–†–ê–ù–°–ö–†–ò–ë–ê–¶–ò–Ø–ú                               ‚îÇ
‚îÇ     ‚Ä¢ –ö–∞–∂–¥–∞—è transcription_id = –æ—Ç–¥–µ–ª—å–Ω—ã–π "—á–∞–Ω–∫ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è"‚îÇ
‚îÇ     ‚Ä¢ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: {transcription_id, audio_file_name, date,     ‚îÇ
‚îÇ                    employee, client, place, report_type}        ‚îÇ
‚îÇ     ‚Ä¢ –¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–æ–≤ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä—É–µ—Ç—Å—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (JSON)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3. –†–ê–ó–ë–ò–ï–ù–ò–ï –ù–ê –ß–ê–ù–ö–ò (RecursiveCharacterTextSplitter)         ‚îÇ
‚îÇ     ‚Ä¢ Chunk size: 800 —Å–∏–º–≤–æ–ª–æ–≤                                  ‚îÇ
‚îÇ     ‚Ä¢ Overlap: 100 —Å–∏–º–≤–æ–ª–æ–≤                                     ‚îÇ
‚îÇ     ‚Ä¢ Separators: "\n\n", "\n", " ", ""                         ‚îÇ
‚îÇ     ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç: ~22,000-38,000 —á–∞–Ω–∫–æ–≤ –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏–π              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4. –°–û–ó–î–ê–ù–ò–ï EMBEDDINGS (SentenceTransformer)                   ‚îÇ
‚îÇ     ‚Ä¢ –ú–æ–¥–µ–ª—å: all-MiniLM-L6-v2                                  ‚îÇ
‚îÇ     ‚Ä¢ –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–µ–∫—Ç–æ—Ä–∞: 384                                  ‚îÇ
‚îÇ     ‚Ä¢ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: True                                        ‚îÇ
‚îÇ     ‚Ä¢ –§–æ—Ä–º–∞—Ç: numpy array ‚Üí list[float]                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  5. –°–û–ó–î–ê–ù–ò–ï FAISS –ò–ù–î–ï–ö–°–ê (FAISS.from_documents)               ‚îÇ
‚îÇ     ‚Ä¢ –¢–∏–ø –∏–Ω–¥–µ–∫—Å–∞: Flat (—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫)                          ‚îÇ
‚îÇ     ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∞: L2 (Euclidean distance)                          ‚îÇ
‚îÇ     ‚Ä¢ –•—Ä–∞–Ω–µ–Ω–∏–µ: index.faiss (–≤–µ–∫—Ç–æ—Ä—ã) + index.pkl (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  6. –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê –î–ò–°–ö (rag_persistence.py)                     ‚îÇ
‚îÇ     ‚Ä¢ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: /app/rag_indices/                             ‚îÇ
‚îÇ     ‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞: /app/rag_indices/{scenario_name}/              ‚îÇ
‚îÇ     ‚Ä¢ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –§–∏–∑–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–ü—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (—Ö–æ—Å—Ç):**
```
/home/voxpersona_user/VoxPersona/rag_indices/
‚îú‚îÄ‚îÄ Dizayn/           # –ò–Ω–¥–µ–∫—Å –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "–î–∏–∑–∞–π–Ω"
‚îÇ   ‚îú‚îÄ‚îÄ index.faiss   # 34 MB - –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ index.pkl     # 25 MB - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
‚îî‚îÄ‚îÄ Intervyu/         # –ò–Ω–¥–µ–∫—Å –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "–ò–Ω—Ç–µ—Ä–≤—å—é"
    ‚îú‚îÄ‚îÄ index.faiss   # 56 MB - –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ index.pkl     # 42 MB - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã

–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: 156 MB
```

**–ü—É—Ç—å –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:**
```
/app/rag_indices/
```

**–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –¢–∏–ø: bind mount
- Source: `/home/voxpersona_user/VoxPersona/rag_indices`
- Destination: `/app/rag_indices`
- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

#### SQL –∑–∞–ø—Ä–æ—Å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (`storage.py:_SQL`)

```sql
WITH base AS (
    SELECT
        a.transcription_id,
        a.audit_date,
        t.audio_file_name,
        t.number_audio,
        a.audit_id,
        a.audit AS audit_text,
        e.employee_name,
        c.client_name,
        p.place_name,
        p.building_type,
        (SELECT json_agg(z.zone_name)
         FROM place_zone pz
         JOIN zone z ON z.zone_id = pz.zone_id
         WHERE pz.place_id = p.place_id) AS zone_names,
        ci.city_name,
        s.scenario_name,
        rt.report_type_desc
    FROM audit a
    JOIN transcription t ON t.transcription_id = a.transcription_id
    JOIN user_road ur ON ur.audit_id = a.audit_id
    JOIN scenario s ON s.scenario_id = ur.scenario_id
    JOIN report_type rt ON rt.report_type_id = ur.report_type_id
    LEFT JOIN employee e ON e.employee_id = a.employee_id
    LEFT JOIN client c ON c.client_id = a.client_id
    LEFT JOIN place p ON p.place_id = a.place_id
    LEFT JOIN city ci ON ci.city_id = a.city_id
    WHERE
      s.scenario_name = %(scenario_name)s
      AND (%(report_type)s IS NULL OR rt.report_type_desc = %(report_type)s)
)
SELECT * FROM base
ORDER BY transcription_id, report_type_desc, audit_id;
```

#### –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

–ö–∞–∂–¥—ã–π —á–∞–Ω–∫ –∏–Ω–¥–µ–∫—Å–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:

**1. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (JSON –∑–∞–≥–æ–ª–æ–≤–æ–∫):**
```json
{
  "transcription_id": 1147,
  "audit_date": "2025-09-20",
  "audio_file_name": "2025-04-10-–ë—É—Ä–±–æ–Ω –ö—É–Ω—Ç—ã—à–µ–≤–∞.mp3",
  "number_audio": 1,
  "audit_id": 9460,
  "employee_name": "–ö—É–Ω—Ç—ã—à–µ–≤–∞ –ò.–í.",
  "client_name": "–û–û–û –ë—É—Ä–±–æ–Ω",
  "place_name": "–†–µ—Å—Ç–æ—Ä–∞–Ω –ë—É—Ä–±–æ–Ω",
  "building_type": "–†–µ—Å—Ç–æ—Ä–∞–Ω",
  "zone_names": ["–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ª", "VIP –∑–∞–ª"],
  "city_name": "–ö–∞–∑–∞–Ω—å",
  "scenario_name": "–ò–Ω—Ç–µ—Ä–≤—å—é",
  "report_type_desc": "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é"
}
```

**2. –¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞ (–æ—á–∏—â–µ–Ω–Ω—ã–π –æ—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤):**
```
–¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞ –∏–ª–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏...
```

#### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ transcription_id

```python
# storage.py:build_reports_grouped()
grouped: dict[int, list[str]] = collections.defaultdict(list)

for row in database_rows:
    transcription_id = row["transcription_id"]
    header = {...}  # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    parts = [
        json.dumps(header, ensure_ascii=False, default=str),
        clean_text(row["audit_text"])
    ]
    grouped[transcription_id].append("\n\n".join(parts))

return grouped
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ª–æ–≤–∞—Ä—å, –≥–¥–µ –∫–ª—é—á = `transcription_id`, –∑–Ω–∞—á–µ–Ω–∏–µ = —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ (–æ—Ç—á–µ—Ç—ã).

### –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞

#### –≠—Ç–∞–ø 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞

**–§–∞–π–ª:** `src/main.py`

```python
async def load_rags():
    # –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã —Å –¥–∏—Å–∫–∞
    loaded_rags = await asyncio.to_thread(load_rag_indices)

    expected_names = [
        "–ò–Ω—Ç–µ—Ä–≤—å—é", "–î–∏–∑–∞–π–Ω",
        "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é", "–û—Ç—á–µ—Ç –æ —Å–≤—è–∑–∫–∞—Ö",
        "–û–±—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã", "–§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏",
        "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∞—É–¥–∏—Ç–∞",
        "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∞—É–¥–∏—Ç–∞",
        "–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞"
    ]

    # –ï—Å–ª–∏ –∫–∞–∫–∏—Ö-—Ç–æ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–µ—Ç - —Å–æ–∑–¥–∞—ë–º –∑–∞–Ω–æ–≤–æ
    missing = [name for name in expected_names if name not in loaded_rags]

    if missing:
        rags = await asyncio.to_thread(init_rags, loaded_rags)
        await handlers.set_rags(rags)
        save_rag_indices(rags)
```

#### –≠—Ç–∞–ø 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î

**–§–∞–π–ª:** `src/run_analysis.py:init_rags()`

```python
rag_configs = [
    ("–ò–Ω—Ç–µ—Ä–≤—å—é", None, None),  # –í—Å–µ –æ—Ç—á–µ—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é
    ("–î–∏–∑–∞–π–Ω", None, None),    # –í—Å–µ –æ—Ç—á–µ—Ç—ã –¥–ª—è –¥–∏–∑–∞–π–Ω–∞
    # ... –î—Ä—É–≥–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π + —Ç–∏–ø –æ—Ç—á–µ—Ç–∞
]

for scenario_name, report_type, _ in rag_configs:
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
    content = build_reports_grouped(
        scenario_name=scenario_name,
        report_type=report_type
    )

    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ç–µ–∫—Å—Ç —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏
    content_str = grouped_reports_to_string(content)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–∫—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º:

```
# –ß–∞–Ω–∫ transcription_id 1147

{"transcription_id": 1147, ...}

–¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞ 1...

{"transcription_id": 1147, ...}

–¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞ 2...

====================================================================================================

# –ß–∞–Ω–∫ transcription_id 1146

...
```

#### –≠—Ç–∞–ø 3: –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏

**–§–∞–π–ª:** `src/storage.py:create_db_in_memory()`

```python
def create_db_in_memory(markdown_text: str):
    logging.info("–†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —á–∞–Ω–∫–∏...")
    chunks = split_markdown_text(markdown_text)

    # split_markdown_text –∏—Å–ø–æ–ª—å–∑—É–µ—Ç RecursiveCharacterTextSplitter
    # chunk_size=800, chunk_overlap=100
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑–±–∏–µ–Ω–∏—è (–∏–∑ –ª–æ–≥–æ–≤):**

| –°—Ü–µ–Ω–∞—Ä–∏–π   | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤ | –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä | –ú–∞–∫—Å | –ú–∏–Ω |
|------------|-------------------|----------------|------|-----|
| –ò–Ω—Ç–µ—Ä–≤—å—é   | 37,722 —á–∞–Ω–∫–æ–≤     | 619 —Å–∏–º–≤–æ–ª–æ–≤   | 798  | 9   |
| –î–∏–∑–∞–π–Ω     | 22,808 —á–∞–Ω–∫–æ–≤     | 578 —Å–∏–º–≤–æ–ª–æ–≤   | 799  | 4   |

#### –≠—Ç–∞–ø 4: –ü–æ–¥—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤

**–¶–µ–ª—å:** –û—Ü–µ–Ω–∏—Ç—å –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ AI –º–æ–¥–µ–ª–∏.

```python
total_tokens = 0
for doc in chunks_documents:
    tokens = len(doc.page_content.split()) * 1.5  # –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
    total_tokens += tokens

logging.info(f"–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤–æ –≤—Å–µ—Ö —á–∞–Ω–∫–∞—Ö: {int(total_tokens)}")
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ (–∏–∑ –ª–æ–≥–æ–≤):**

| –°—Ü–µ–Ω–∞—Ä–∏–π   | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ |
|------------|--------------------------|
| –ò–Ω—Ç–µ—Ä–≤—å—é   | 4,519,318 —Ç–æ–∫–µ–Ω–æ–≤        |
| –î–∏–∑–∞–π–Ω     | 2,326,696 —Ç–æ–∫–µ–Ω–æ–≤        |

#### –≠—Ç–∞–ø 5: –°–æ–∑–¥–∞–Ω–∏–µ embeddings

**–§–∞–π–ª:** `src/utils.py`

```python
class CustomSentenceTransformerEmbeddings(Embeddings):
    def embed_documents(self, texts: list[str]) -> list[list[float]]:
        embeddings = self.model.encode(
            texts,
            normalize_embeddings=True,
            convert_to_numpy=True
        )
        return embeddings.tolist()
```

**–ú–æ–¥–µ–ª—å:** `all-MiniLM-L6-v2`
- –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 384 –∏–∑–º–µ—Ä–µ–Ω–∏—è
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –î–∞ (–¥–ª—è –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞)
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: CPU

#### –≠—Ç–∞–ø 6: –°–æ–∑–¥–∞–Ω–∏–µ FAISS –∏–Ω–¥–µ–∫—Å–∞

**–§–∞–π–ª:** `src/storage.py:create_db_in_memory()`

```python
model = get_embedding_model()
embedding = CustomSentenceTransformerEmbeddings(model)

db_index = FAISS.from_documents(
    documents=chunks_documents,
    embedding=embedding
)
```

**–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è (–∏–∑ –ª–æ–≥–æ–≤):**

| –°—Ü–µ–Ω–∞—Ä–∏–π   | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è FAISS –∏–Ω–¥–µ–∫—Å–∞ | –û–±—â–µ–µ –≤—Ä–µ–º—è |
|------------|------------------------------|-------------|
| –ò–Ω—Ç–µ—Ä–≤—å—é   | 808.25 —Å–µ–∫—É–Ω–¥ (~13.5 –º–∏–Ω)    | 809.30 —Å–µ–∫  |
| –î–∏–∑–∞–π–Ω     | 485.09 —Å–µ–∫—É–Ω–¥ (~8 –º–∏–Ω)       | 485.48 —Å–µ–∫  |

**–¢–∏–ø –∏–Ω–¥–µ–∫—Å–∞:** Flat Index (—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –≤–µ–∫—Ç–æ—Ä–∞–º)

#### –≠—Ç–∞–ø 7: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫

**–§–∞–π–ª:** `src/rag_persistence.py:save_rag_indices()`

```python
def save_rag_indices(rags: dict) -> None:
    for name, index in rags.items():
        if not hasattr(index, "save_local"):
            continue

        path = os.path.join(RAG_INDEX_DIR, safe_filename(name))
        shutil.rmtree(path, ignore_errors=True)
        index.save_local(path)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `index.faiss` - –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- `index.pkl` - pickle —Ñ–∞–π–ª —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

**–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (900 —Å–µ–∫—É–Ω–¥) —á–µ—Ä–µ–∑ `periodic_save_rags()`

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º

| –°—Ü–µ–Ω–∞—Ä–∏–π   | –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π | –û—Ç—á–µ—Ç–æ–≤ | –û—Ç—á–µ—Ç–æ–≤/–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è | –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞ |
|------------|---------------|---------|------------------------|----------------|
| –ò–Ω—Ç–µ—Ä–≤—å—é   | 808           | 7,336   | 9.08                   | 97 MB          |
| –î–∏–∑–∞–π–Ω     | 353           | 2,098   | 5.94                   | 59 MB          |

#### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –æ—Ç—á–µ—Ç–æ–≤

**–ò–Ω—Ç–µ—Ä–≤—å—é:**
- –û–±—â–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã: 2,457 –æ—Ç—á–µ—Ç–æ–≤
- –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é: 1,654 –æ—Ç—á–µ—Ç–∞
- –û—Ç—á–µ—Ç –æ —Å–≤—è–∑–∫–∞—Ö: 1,621 –æ—Ç—á–µ—Ç
- –§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏: 1,604 –æ—Ç—á–µ—Ç–∞

**–î–∏–∑–∞–π–Ω:**
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∞—É–¥–∏—Ç–∞: 708 –æ—Ç—á–µ—Ç–æ–≤
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞: 700 –æ—Ç—á–µ—Ç–æ–≤
- –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∞—É–¥–∏—Ç–∞: 690 –æ—Ç—á–µ—Ç–æ–≤

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ Telegram –±–æ—Ç–µ

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å –≤ Telegram
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø –ó–ê–ü–†–û–°–ê               ‚îÇ
‚îÇ    ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (–ò–Ω—Ç–µ—Ä–≤—å—é/–î–∏–∑–∞–π–Ω) ‚îÇ
‚îÇ    ‚Ä¢ –§—É–Ω–∫—Ü–∏—è: classify_query()          ‚îÇ
‚îÇ    ‚Ä¢ –ü—Ä–æ–º–ø—Ç: prompt_classify            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. –í–´–ë–û–† –ò–ù–î–ï–ö–°–ê                       ‚îÇ
‚îÇ    ‚Ä¢ rags["–ò–Ω—Ç–µ—Ä–≤—å—é"] –∏–ª–∏ rags["–î–∏–∑–∞–π–Ω"]‚îÇ
‚îÇ    ‚Ä¢ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏ (–Ω–µ —Å –¥–∏—Å–∫–∞) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. –°–ï–ú–ê–ù–¢–ò–ß–ï–°–ö–ò–ô –ü–û–ò–°–ö (FAISS)         ‚îÇ
‚îÇ    ‚Ä¢ db_index.similarity_search(query, k=15) ‚îÇ
‚îÇ    ‚Ä¢ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 15 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ ‚îÇ
‚îÇ    ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∞: L2 distance (Euclidean)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–í–ï–¢–ê (Claude AI)        ‚îÇ
‚îÇ    ‚Ä¢ System prompt + –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —á–∞–Ω–∫–∏   ‚îÇ
‚îÇ    ‚Ä¢ –ú–æ–¥–µ–ª—å: claude-sonnet-4-20250514  ‚îÇ
‚îÇ    ‚Ä¢ –ú–∞–∫—Å —Ç–æ–∫–µ–Ω—ã: 20,000               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             ‚ñº
    –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

#### –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ (Fast Search)

**–§–∞–π–ª:** `src/run_analysis.py:run_fast_search()`

##### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –≤–µ–∫—Ç–æ—Ä–∞–º** —á–µ—Ä–µ–∑ FAISS –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

##### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      ‚îÇ
      ‚ñº
1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –≤ –≤–µ–∫—Ç–æ—Ä (embedding)
   ‚Ä¢ –ú–æ–¥–µ–ª—å: all-MiniLM-L6-v2
   ‚Ä¢ –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 384
      ‚îÇ
      ‚ñº
2. –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ FAISS –∏–Ω–¥–µ–∫—Å–µ
   ‚Ä¢ –ú–µ—Ç–æ–¥: db_index.similarity_search(query, k=15)
   ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∞: L2 distance (Euclidean)
   ‚Ä¢ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 15 –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ—Ö–æ–∂–∏—Ö —á–∞–Ω–∫–æ–≤
      ‚îÇ
      ‚ñº
3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   ‚Ä¢ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —á–∞–Ω–∫–æ–≤
   ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (transcription_id, place_name –∏ —Ç.–¥.)
   ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä: ~4,700 —Ç–æ–∫–µ–Ω–æ–≤
      ‚îÇ
      ‚ñº
4. –ó–∞–ø—Ä–æ—Å –∫ AI –º–æ–¥–µ–ª–∏
   ‚Ä¢ –ú–æ–¥–µ–ª—å: claude-sonnet-4-20250514
   ‚Ä¢ System prompt: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç—á–µ—Ç–æ–≤
   ‚Ä¢ User prompt: –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚Ä¢ Context: 15 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤
      ‚îÇ
      ‚ñº
5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
   ‚Ä¢ Claude –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —á–∞–Ω–∫–∏
   ‚Ä¢ –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   ‚Ä¢ –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```

##### –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```python
def run_fast_search(text: str, rag) -> str:
    answer = generate_db_answer(text, rag)
    return answer

def generate_db_answer(query: str, db_index: FAISS, k: int=15):
    system_prompt = """–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π –æ—Ç—á–µ—Ç—ã –∏–∑ –±–¥, –∫–∞—Å–∞—é—â–∏–µ—Å—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö
    –∏–Ω—Ç–µ—Ä–≤—å—é —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∞ —Ç–∞–∫–∂–µ –∞–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏—Ç–æ–≤ –¥–∏–∑–∞–π–Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
    (–∑–æ–Ω—ã –æ—Ç–µ–ª—è, —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã, —Ü–µ–Ω—Ç—Ä—ã –∑–¥–æ—Ä–æ–≤—å—è (–°–ü–ê)) –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑–Ω—ã—Ö –¥–∏–∑–∞–π–Ω–µ—Ä–æ–≤.
    –≠—Ç–æ –º–∞–ª–∞—è —á–∞—Å—Ç—å –æ—Ç—á–µ—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–æ–±—Ä–∞–Ω—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–æ–∏—Å–∫–∞ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
    –∏–∑ –±–æ–ª—å—à–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∑–∞–¥–∞–Ω –≤–æ–ø—Ä–æ—Å. –¢–µ–±–µ –Ω—É–∂–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª–µ–µ
    —á–µ—Ç–∫–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –¥–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å. –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–±–µ –æ—Ç—á–µ—Ç–∞—Ö —Ç—ã –Ω–µ –≤–∏–¥–∏—à—å
    –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–º–µ–Ω–Ω–æ —Ç–∞–∫ –∏ —Å–∫–∞–∂–∏ –Ω–µ –Ω–∞–¥–æ –Ω–∏—á–µ–≥–æ –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –æ—Ç —Å–µ–±—è."""

    # –®–∞–≥ 1: –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    similar_documents = db_index.similarity_search(query, k=k)

    # –®–∞–≥ 2: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    message_content = re.sub(r'\n{2}', ' ', '\n '.join([
        f'–û—Ç—á–µ—Ç ‚Ññ {i+1}:\n' + doc.page_content
        for i, doc in enumerate(similar_documents)
    ]))

    # –®–∞–≥ 3: –ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
    system_tokens = count_tokens(system_prompt)
    docs_tokens = count_tokens(message_content)
    query_tokens = count_tokens(query)
    total_tokens = system_tokens + docs_tokens + query_tokens

    logging.info(f"–¢–æ–∫–µ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞: {system_tokens}")
    logging.info(f"–¢–æ–∫–µ–Ω—ã –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {docs_tokens}")
    logging.info(f"–¢–æ–∫–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {query_tokens}")
    logging.info(f"–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤: {total_tokens}")

    # –®–∞–≥ 4: –ó–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏
    messages = [{"role": "user", "content": f'–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {query}'}]
    response = send_msg_to_model(
        messages=messages,
        system=f'{system_prompt} –í–æ—Ç –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –∏–∑ –±–¥: \n{message_content}'
    )

    return response
```

##### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä                  | –ó–Ω–∞—á–µ–Ω–∏–µ                          |
|---------------------------|-----------------------------------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤         | 15 (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ)                  |
| –ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞              | FAISS similarity_search           |
| –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞      | 3-7 —Å–µ–∫—É–Ω–¥                        |
| –¢–æ–∫–µ–Ω—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å          | ~4,700 (–≤ —Å—Ä–µ–¥–Ω–µ–º)                |
| API –∫–ª—é—á–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è   | 1 (–æ—Å–Ω–æ–≤–Ω–æ–π)                      |
| –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è            | –ù–µ—Ç                               |
| –¢–æ—á–Ω–æ—Å—Ç—å                  | –í—ã—Å–æ–∫–∞—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤   |
| –ü–æ–ª–Ω–æ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è          | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ 15 —á–∞–Ω–∫–∞–º–∏             |

##### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫?

**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —á–µ—Ç–∫–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ó–∞–ø—Ä–æ—Å–æ–≤ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–µ—Å—Ç–µ/—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ/–¥–∞—Ç–µ
- –ë—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –í–æ–ø—Ä–æ—Å–æ–≤, –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º-–¥–≤—É—Ö –æ—Ç—á–µ—Ç–∞—Ö

**‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –®–∏—Ä–æ–∫–∏—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ä–∞–≤–Ω–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤
- –ü–æ–∏—Å–∫–∞ —Ä–µ–¥–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ –≤—Å–µ–π –±–∞–∑–µ
- –í–æ–ø—Ä–æ—Å–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö –æ–±–æ–±—â–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:**
- "–ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Å–≤–µ—â–µ–Ω–∏–µ–º –±—ã–ª–∏ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –ë—É—Ä–±–æ–Ω?"
- "–ß—Ç–æ –ö—É–Ω—Ç—ã—à–µ–≤–∞ –ò.–í. —Å–∫–∞–∑–∞–ª–∞ –ø—Ä–æ –¥–∏–∑–∞–π–Ω –æ—Ç–µ–ª—è?"
- "–ö–∞–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∑–æ–Ω—ã —Å–ø–∞?"

---

#### –ì–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫ (Deep Search)

**–§–∞–π–ª:** `src/run_analysis.py:run_deep_search()`

##### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

–ì–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫ **–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —á–∞–Ω–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è** (1,147 —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π = ~800-1,200 —á–∞–Ω–∫–æ–≤), –∏—Å–ø–æ–ª—å–∑—É—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ 7 API –∫–ª—é—á–µ–π –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ü–∏—Ç–∞—Ç –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.

##### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

```
–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      ‚îÇ
      ‚ñº
1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –í–°–ï–• –¥–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è –∏–∑ –ë–î
   ‚Ä¢ build_reports_grouped(scenario_name)
   ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ + –≤—Å–µ –æ—Ç—á–µ—Ç—ã —Å—Ü–µ–Ω–∞—Ä–∏—è
      ‚îÇ
      ‚ñº
2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ –ø–æ transcription_id
   ‚Ä¢ Regex: r'^# –ß–∞–Ω–∫ transcription_id \d+'
   ‚Ä¢ –ò–Ω—Ç–µ—Ä–≤—å—é: ~808 —á–∞–Ω–∫–æ–≤
   ‚Ä¢ –î–∏–∑–∞–π–Ω: ~353 —á–∞–Ω–∫–∞
      ‚îÇ
      ‚ñº
3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞–Ω–∫–æ–≤ (7 –º–æ–¥–µ–ª–µ–π)
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ –î–ª—è –ö–ê–ñ–î–û–ì–û —á–∞–Ω–∫–∞:                     ‚îÇ
   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
   ‚îÇ ‚îÇ Model 0 (API key 1):               ‚îÇ ‚îÇ
   ‚îÇ ‚îÇ ‚Ä¢ –ß–∞–Ω–∫–∏: 0, 7, 14, 21, ...         ‚îÇ ‚îÇ
   ‚îÇ ‚îÇ ‚Ä¢ Rate: 80k tok/min, 2k req/min    ‚îÇ ‚îÇ
   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
   ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
   ‚îÇ ‚îÇ Model 1 (API key 2):               ‚îÇ ‚îÇ
   ‚îÇ ‚îÇ ‚Ä¢ –ß–∞–Ω–∫–∏: 1, 8, 15, 22, ...         ‚îÇ ‚îÇ
   ‚îÇ ‚îÇ ‚Ä¢ Rate: 20k tok/min, 50 req/min    ‚îÇ ‚îÇ
   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
   ‚îÇ       ... –º–æ–¥–µ–ª–∏ 2-6 ...               ‚îÇ
   ‚îÇ                                        ‚îÇ
   ‚îÇ –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç:              ‚îÇ
   ‚îÇ 1. –ü–æ–ª—É—á–∞–µ—Ç —á–∞–Ω–∫ –∏–∑ –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏     ‚îÇ
   ‚îÇ 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Claude —Å prompt_extract‚îÇ
   ‚îÇ 3. –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç (—Ü–∏—Ç–∞—Ç–∞ –∏–ª–∏ "##not_found##")‚îÇ
   ‚îÇ 4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç                ‚îÇ
   ‚îÇ 5. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É (rate limiting) ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îÇ
      ‚ñº
4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   ‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ "##not_found##" (—á–∞–Ω–∫–∏ –±–µ–∑ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ—ã)
   ‚Ä¢ –£–¥–∞–ª–µ–Ω–∏–µ "[ERROR]" (–æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏)
   ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–ø–∏—Å–æ–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ü–∏—Ç–∞—Ç
      ‚îÇ
      ‚ñº
5. –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç
   ‚Ä¢ –ü—Ä–æ–º–ø—Ç: prompt_agg
   ‚Ä¢ Claude –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ü–∏—Ç–∞—Ç—ã –≤ —Å–≤—è–∑–Ω—ã–π –æ—Ç–≤–µ—Ç
   ‚Ä¢ –£–±–∏—Ä–∞–µ—Ç –¥—É–±–ª–∏ –∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è
   ‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
      ‚îÇ
      ‚ñº
6. –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

##### –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```python
def run_deep_search(content: str, text: str, chat_id: int, app: Client, category: str) -> str:
    # 7 API –∫–ª—é—á–µ–π –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
    api_keys = [
        ANTHROPIC_API_KEY,      # Model 0: 80k tok/min, 2k req/min
        ANTHROPIC_API_KEY_2,    # Model 1: 20k tok/min, 50 req/min
        ANTHROPIC_API_KEY_3,    # Model 2: 20k tok/min, 50 req/min
        ANTHROPIC_API_KEY_4,    # Model 3: 20k tok/min, 50 req/min
        ANTHROPIC_API_KEY_5,    # Model 4: 20k tok/min, 50 req/min
        ANTHROPIC_API_KEY_6,    # Model 5: 20k tok/min, 50 req/min
        ANTHROPIC_API_KEY_7     # Model 6: 20k tok/min, 50 req/min
    ]

    # –®–∞–≥ 1: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ –ø–æ transcription_id
    chunks = re.split(r'^# –ß–∞–Ω–∫ transcription_id \d+', content, flags=re.MULTILINE)
    chunks = [chunk.strip() for chunk in chunks if chunk.strip()]

    logging.info(f"–ü–æ–ª—É—á–µ–Ω–æ {len(chunks)} —á–∞–Ω–∫–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è {category}")

    # –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
    extract_prompt = fetch_prompt_by_name(prompt_name="prompt_extract")
    aggregation_prompt = fetch_prompt_by_name(prompt_name="prompt_agg")

    # –®–∞–≥ 3: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    async def main():
        async with aiohttp.ClientSession() as session:
            return await extract_from_chunk_parallel_async(
                text=text,
                chunks=chunks,
                extract_prompt=extract_prompt,
                api_keys=api_keys,
                session=session
            )

    try:
        loop = asyncio.get_event_loop()
        results = loop.run_until_complete(main())
    except RuntimeError:
        results = asyncio.run(main())

    # –®–∞–≥ 4: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    citations = [r for r in results if r != "##not_found##" and not r.startswith("[ERROR]")]

    # –®–∞–≥ 5: –ê–≥—Ä–µ–≥–∞—Ü–∏—è
    if citations:
        aggregated_answer = aggregate_citations(
            text=text,
            citations=citations,
            aggregation_prompt=aggregation_prompt
        )
    else:
        aggregated_answer = "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ç—á–µ—Ç–∞—Ö."

    return aggregated_answer
```

##### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å rate limiting

```python
async def extract_from_chunk_parallel_async(
    text: str,
    chunks: list[str],
    extract_prompt: str,
    api_keys: list[str],
    session: aiohttp.ClientSession
) -> list[str | None]:
    # Rate limits –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
    token_limits_per_min = [80000, 20000, 20000, 20000, 20000, 20000, 20000]
    req_limits_per_min   = [2000,    50,    50,    50,    50,    50,    50]

    # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ç–æ–∫–µ–Ω—ã/—Å–µ–∫—É–Ω–¥—É –∏ –∑–∞–ø—Ä–æ—Å—ã/—Å–µ–∫—É–Ω–¥—É
    token_rates = [tl / 60.0 for tl in token_limits_per_min]
    req_rates = [rl / 60.0 for rl in req_limits_per_min]

    # –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏ —á–∞–Ω–∫–æ–≤
    q = asyncio.Queue()
    for idx, chunk in enumerate(chunks):
        await q.put((idx, chunk))

    results: list[str | None] = [None] * len(chunks)
    model_semaphores = [BoundedSemaphore(1) for _ in range(len(api_keys))]

    # –ó–∞–ø—É—Å–∫ 7 workers (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ API –∫–ª—é—á)
    workers = [
        asyncio.create_task(_process_single_chunk_async(
            q, text, extract_prompt, model_idx, api_key,
            token_rates[model_idx], req_rates[model_idx],
            model_semaphores[model_idx], session, results
        ))
        for model_idx, api_key in enumerate(api_keys)
    ]

    # –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤
    await q.join()

    # –û—Ç–º–µ–Ω–∞ workers
    for task in workers:
        task.cancel()

    return results
```

##### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —á–∞–Ω–∫–∞

```python
async def _process_single_chunk_async(
    q: asyncio.Queue,
    text: str,
    extract_prompt: str,
    model_idx: int,
    api_key: str,
    token_rate: float,
    req_rate: float,
    model_semaphore: BoundedSemaphore,
    session: aiohttp.ClientSession,
    results: list
):
    while True:
        # –ë–µ—Ä–µ–º —Å–ª–µ–¥—É—é—â–∏–π —á–∞–Ω–∫ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
        try:
            idx, chunk = q.get_nowait()
        except asyncio.QueueEmpty:
            break

        # –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
        user_content = f"–î–æ–∫—É–º–µ–Ω—Ç:\n{chunk}\n\n{text}"
        tokens = count_tokens(user_content)

        # –í—ã—á–∏—Å–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–µ rate limits
        req_delay = 1.0 / req_rate if req_rate > 0 else float("inf")
        token_delay = tokens / token_rate if token_rate > 0 else float("inf")
        delay = max(token_delay, req_delay)

        logging.info(f"[Model#{model_idx}] –ß–∞–Ω–∫ #{idx}: {tokens} —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí delay={delay:.1f}s")

        # –ü—Ä–∏–º–µ–Ω—è–µ–º rate limiting —á–µ—Ä–µ–∑ semaphore
        async with model_semaphore:
            await asyncio.sleep(delay)

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        messages = [{"role": "user", "content": user_content}]
        response = await send_msg_to_model_async(
            session=session,
            messages=messages,
            system=extract_prompt,
            model=REPORT_MODEL_NAME or "claude-sonnet-4-20250514",
            api_key=api_key,
            err=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —á–∞–Ω–∫–∞ #{idx}"
        )

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        results[idx] = response
        q.task_done()
```

##### –ü—Ä–æ–º–ø—Ç—ã –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞

**1. prompt_extract (1,070 —Å–∏–º–≤–æ–ª–æ–≤):**
```
–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é,
–æ—Ç–Ω–æ—Å—è—â—É—é—Å—è –∫ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
1. –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏ –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–æ–∫—É–º–µ–Ω—Ç
3. –ï—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—à—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é - –≤–µ—Ä–Ω–∏ —Ç–æ—á–Ω—É—é —Ü–∏—Ç–∞—Ç—É
4. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ—Ç - –≤–µ—Ä–Ω–∏ "##not_found##"
5. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
```

**2. prompt_agg (1,918 —Å–∏–º–≤–æ–ª–æ–≤):**
```
–¢—ã - –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –æ–±–æ–±—â–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä —Ü–∏—Ç–∞—Ç, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
–ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –Ω–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤—è–∑–Ω—ã–π, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
1. –ò–∑—É—á–∏ –≤—Å–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã
2. –ù–∞–π–¥–∏ –æ–±—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ —Ç–µ–º—ã
3. –£–±–µ—Ä–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
4. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ª–æ–≥–∏—á–Ω–æ
5. –°–æ—Å—Ç–∞–≤—å —Å–≤—è–∑–Ω—ã–π –æ—Ç–≤–µ—Ç
```

##### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä                  | –ó–Ω–∞—á–µ–Ω–∏–µ                          |
|---------------------------|-----------------------------------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤         | –í—Å–µ (808 –¥–ª—è –ò–Ω—Ç–µ—Ä–≤—å—é, 353 –¥–ª—è –î–∏–∑–∞–π–Ω–∞) |
| –ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞              | –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ AI –∏–∑ –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ |
| –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞      | 30-120 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª-–≤–∞ —á–∞–Ω–∫–æ–≤) |
| –¢–æ–∫–µ–Ω—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å          | 50,000-200,000 (—Å—É–º–º–∞—Ä–Ω–æ –ø–æ –≤—Å–µ–º —á–∞–Ω–∫–∞–º) |
| API –∫–ª—é—á–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è   | 7 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)        |
| –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è            | –î–∞ (7 workers)                    |
| –¢–æ—á–Ω–æ—Å—Ç—å                  | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |
| –ü–æ–ª–Ω–æ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è          | 100% —Å—Ü–µ–Ω–∞—Ä–∏—è                     |

##### Rate Limiting

| Model | API Key | –¢–æ–∫–µ–Ω–æ–≤/–º–∏–Ω | –ó–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω | –¢–æ–∫–µ–Ω–æ–≤/—Å–µ–∫ | –ó–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ |
|-------|---------|-------------|--------------|-------------|--------------|
| 0     | Key 1   | 80,000      | 2,000        | 1,333       | 33.3         |
| 1     | Key 2   | 20,000      | 50           | 333         | 0.83         |
| 2     | Key 3   | 20,000      | 50           | 333         | 0.83         |
| 3     | Key 4   | 20,000      | 50           | 333         | 0.83         |
| 4     | Key 5   | 20,000      | 50           | 333         | 0.83         |
| 5     | Key 6   | 20,000      | 50           | 333         | 0.83         |
| 6     | Key 7   | 20,000      | 50           | 333         | 0.83         |
| **Œ£** | **7**   | **200,000** | **2,350**    | **3,333**   | **39.2**     |

##### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫?

**‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –®–∏—Ä–æ–∫–∏—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- –°—Ä–∞–≤–Ω–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤/–º–µ—Å—Ç
- –ü–æ–∏—Å–∫–∞ —Ä–µ–¥–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø–æ –≤—Å–µ–π –±–∞–∑–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–æ–±—â–µ–Ω–∏–π
- –í–æ–ø—Ä–æ—Å–æ–≤ –≤–∏–¥–∞ "–ö–∞–∫–∏–µ –æ–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã...?"

**‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ü—Ä–æ—Å—Ç—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (—Ç—Ä–∞—Ç–∏—Ç—Å—è –≤—Ä–µ–º—è)
- –°—Ä–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–æ–ª–≥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
- –í–æ–ø—Ä–æ—Å–æ–≤ —Å –æ—á–µ–≤–∏–¥–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:**
- "–ö–∞–∫–∏–µ —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–∏–∑–∞–π–Ω–æ–º –≤–æ –≤—Å–µ—Ö –æ—Ç–µ–ª—è—Ö?"
- "–°—Ä–∞–≤–Ω–∏ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—é –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é —É —Ä–∞–∑–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"
- "–ù–∞–π–¥–∏ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –æ—Å–≤–µ—â–µ–Ω–∏–µ–º"
- "–ö–∞–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã —á–∞—â–µ –≤—Å–µ–≥–æ –≤–ª–∏—è—é—Ç –Ω–∞ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤?"

---

#### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ–≥–æ –∏ –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫                | –ì–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫                   |
|------------------------------|------------------------------|----------------------------------|
| **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**         | 3-7 —Å–µ–∫—É–Ω–¥                   | 30-120 —Å–µ–∫—É–Ω–¥                    |
| **–û—Ö–≤–∞—Ç –¥–∞–Ω–Ω—ã—Ö**             | 15 —á–∞–Ω–∫–æ–≤ (~1-2%)            | –í—Å–µ —á–∞–Ω–∫–∏ (100%)                 |
| **–ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞**             | –í–µ–∫—Ç–æ—Ä–Ω—ã–π (FAISS)            | –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä —á–µ—Ä–µ–∑ AI          |
| **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è**           | –ù–µ—Ç (1 –∑–∞–ø—Ä–æ—Å)               | –î–∞ (7 workers)                   |
| **API –∫–ª—é—á–∏**                | 1                            | 7                                |
| **–¢–æ–∫–µ–Ω—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å**         | ~4,700                       | 50,000-200,000                   |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å**                | ~$0.03                       | ~$3-10                           |
| **–¢–æ—á–Ω–æ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≤–æ–ø—Ä.**| –í—ã—Å–æ–∫–∞—è                      | –°—Ä–µ–¥–Ω—è—è                          |
| **–ü–æ–ª–Ω–æ—Ç–∞ —à–∏—Ä–æ–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤** | –ù–∏–∑–∫–∞—è                       | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è                    |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**         | –ù–µ—Ç retry                    | Retry + backoff                  |
| **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**   | –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è                 | –£–¥–∞–ª–µ–Ω–∏–µ "##not_found##"         |
| **–ê–≥—Ä–µ–≥–∞—Ü–∏—è**                | –ù–µ—Ç (–ø—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç)           | –î–∞ (prompt_agg)                  |

##### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É —Ä–µ–∂–∏–º–∞

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏:**
- –í–æ–ø—Ä–æ—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
- –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (–º–µ–Ω–µ–µ 10 —Å–µ–∫—É–Ω–¥)
- –ë—é–¥–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–∂–∏–¥–∞–µ—Ç —Ç–æ—á–µ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏:**
- –í–æ–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ –≤—Å–µ–π –±–∞–∑—ã
- –ù—É–∂–Ω—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–ª–∏ –æ–±–æ–±—â–µ–Ω–∏—è
- –ò—â–µ—Ç–µ —Ä–µ–¥–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
- –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–æ–ª–Ω–æ—Ç–∞ –æ—Ç–≤–µ—Ç–∞

##### –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)

–î–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–¥–≤—É—Ö—Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π –ø–æ–∏—Å–∫**:

1. **–ü–µ—Ä–≤–∞—è —Å—Ç—É–ø–µ–Ω—å** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
2. **–í—Ç–æ—Ä–∞—è —Å—Ç—É–ø–µ–Ω—å** - –µ—Å–ª–∏ –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Üí –≥–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫

```python
def hybrid_search(text: str, rag, content: str, chat_id: int, app: Client):
    # –®–∞–≥ 1: –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
    fast_answer = run_fast_search(text, rag)

    # –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–∞
    if "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ" in fast_answer.lower() or "–Ω–µ –≤–∏–∂—É" in fast_answer.lower():
        # –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Üí –≥–ª—É–±–æ–∫–∏–π
        app.send_message(chat_id, "–ó–∞–ø—É—Å–∫–∞—é —É–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫...")
        return run_deep_search(content, text, chat_id, app, category)
    else:
        return fast_answer
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

#### –ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ?

1. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞ –¥–∏—Å–∫–µ
2. **–ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **–í—Ä—É—á–Ω—É—é** - –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞

#### –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –∑–∞–Ω–∏–º–∞–µ—Ç ~13.5 –º–∏–Ω—É—Ç –¥–ª—è –ò–Ω—Ç–µ—Ä–≤—å—é.

**–†–µ—à–µ–Ω–∏–µ:** –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å—ã –ø–µ—Ä–µ—Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å FAISS –º–µ—Ç–æ–¥ `add_documents()` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

#### –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

| –û–ø–µ—Ä–∞—Ü–∏—è                        | –í—Ä–µ–º—è           |
|---------------------------------|-----------------|
| –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ —Å –¥–∏—Å–∫–∞        | ~1-2 —Å–µ–∫—É–Ω–¥—ã    |
| Similarity search (k=15)        | ~0.1 —Å–µ–∫—É–Ω–¥—ã    |
| –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ "–ò–Ω—Ç–µ—Ä–≤—å—é"     | ~13.5 –º–∏–Ω—É—Ç     |
| –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ "–î–∏–∑–∞–π–Ω"       | ~8 –º–∏–Ω—É—Ç        |

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω RAM:**
   - –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä: 156 MB
   - –ü—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

2. **Flat Index = –ª–∏–Ω–µ–π–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å:**
   - –ö–∞–∂–¥—ã–π –ø–æ–∏—Å–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –≤–µ–∫—Ç–æ—Ä—ã
   - –î–ª—è –º–∏–ª–ª–∏–æ–Ω–æ–≤ –≤–µ–∫—Ç–æ—Ä–æ–≤ –Ω—É–∂–µ–Ω IVF –∏–ª–∏ HNSW –∏–Ω–¥–µ–∫—Å

3. **–ù–µ—Ç GPU —É—Å–∫–æ—Ä–µ–Ω–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CPU –≤–µ—Ä—Å–∏—è FAISS
   - GPU –º–æ–∂–µ—Ç —É—Å–∫–æ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –≤ 10-100 —Ä–∞–∑

4. **–ß–∞–Ω–∫–∏ –Ω–µ –∏–º–µ—é—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –º–µ–∂–¥—É —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è–º–∏:**
   - –ö–∞–∂–¥—ã–π —á–∞–Ω–∫ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –æ–¥–Ω–æ–π transcription_id
   - –ú–æ–∂–µ—Ç —É—Ö—É–¥—à–∏—Ç—å –ø–æ–∏—Å–∫ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤—å—é

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

#### –õ–æ–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–æ–∑–¥–∞–Ω–∏—è FAISS –∏–Ω–¥–µ–∫—Å–æ–≤
docker logs voxpersona_app 2>&1 | grep -i 'faiss\|–∏–Ω–¥–µ–∫—Å\|—á–∞–Ω–∫'
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
[2025-09-21 03:26:04] INFO: ‚úÖ –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ 0.36—Å. –ü–æ–ª—É—á–µ–Ω–æ 37722 —á–∞–Ω–∫–æ–≤
[2025-09-21 03:26:04] INFO: üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∞–Ω–∫–æ–≤: —Å—Ä–µ–¥–Ω–∏–π=619, –º–∞–∫—Å=798, –º–∏–Ω=9 —Å–∏–º–≤.
[2025-09-21 03:26:04] INFO: üß† –ü–æ–¥—Å—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ 0.25—Å. –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤: 4,519,318
[2025-09-21 03:43:19] INFO: ‚úÖ FAISS –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–Ω –∑–∞ 808.25—Å
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ

```bash
# –†–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤
du -sh /home/voxpersona_user/VoxPersona/rag_indices/*

# –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
stat -c '%y' /home/voxpersona_user/VoxPersona/rag_indices/Intervyu/index.faiss
```

#### SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º
SELECT
    s.scenario_name,
    COUNT(ur.user_road_id) as total_reports
FROM user_road ur
JOIN scenario s ON ur.scenario_id = s.scenario_id
GROUP BY s.scenario_name;
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

1. **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤:**
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
   - –£–¥–∞–ª–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/app/rag_indices/` –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—é

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:**
   ```python
   with psycopg2.connect(**DB_CONFIG) as conn:
       # –í–∞—à–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î
       conn.commit()

   # –ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ - –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
   rags = init_rags()
   save_rag_indices(rags)
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤:**
   - –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 1 GB RAM —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ IVF –∏–Ω–¥–µ–∫—Å–∞
   - FAISS IVF –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –≤–µ–∫—Ç–æ—Ä—ã –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä—ã

4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
   ```python
   # –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
   test_query = "–ö–∞–∫–∏–µ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–∏–∑–∞–π–Ω–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤?"
   results = db_index.similarity_search(test_query, k=5)
   for i, doc in enumerate(results):
       print(f"Result {i+1}: {doc.page_content[:200]}...")
   ```

5. **–ë—ç–∫–∞–ø—ã –∏–Ω–¥–µ–∫—Å–æ–≤:**
   ```bash
   # –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –∏–Ω–¥–µ–∫—Å–æ–≤
   tar -czf rag_indices_backup_$(date +%Y%m%d).tar.gz \
       /home/voxpersona_user/VoxPersona/rag_indices/

   # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
   tar -xzf rag_indices_backup_20251002.tar.gz -C /
   ```

---

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ (–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è #1147)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ê—É–¥–∏–æ—Ñ–∞–π–ª: `2025-04-10-–ë—É—Ä–±–æ–Ω –ö—É–Ω—Ç—ã—à–µ–≤–∞.mp3`
- –î–∞—Ç–∞: 20 —Å–µ–Ω—Ç—è–±—Ä—è 2025

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**

1. **–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è** (ID: 1147)
   - –¢–µ–∫—Å—Ç: 25,807 —Å–∏–º–≤–æ–ª–æ–≤
   - –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –ò–Ω—Ç–µ—Ä–≤—å—é –¥–∏–∑–∞–π–Ω–µ—Ä–∞-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è –ö—É–Ω—Ç—ã—à–µ–≤–æ–π –ò.–í. –æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –ë—É—Ä–±–æ–Ω

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤** (4 –æ—Ç—á–µ—Ç–∞):
   - –û—Ç—á–µ—Ç #9460 (–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é) - 7,000 —Å–∏–º–≤–æ–ª–æ–≤
   - –û—Ç—á–µ—Ç #9461 (–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é) - 57 —Å–∏–º–≤–æ–ª–æ–≤ (JSON)
   - –û—Ç—á–µ—Ç #9462 (–§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏) - 13,522 —Å–∏–º–≤–æ–ª–æ–≤
   - –û—Ç—á–µ—Ç #9463 (–§–∞–∫—Ç–æ—Ä—ã –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏) - 318 —Å–∏–º–≤–æ–ª–æ–≤ (JSON)

3. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** (4 –∑–∞–ø–∏—Å–∏ –≤ user_road):
   - –í—Å–µ –æ—Ç—á–µ—Ç—ã —Å–≤—è–∑–∞–Ω—ã —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º "–ò–Ω—Ç–µ—Ä–≤—å—é" (scenario_id = 1)
   - –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤: 1 –∏ 3

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–Ω–∞ 2 –æ–∫—Ç—è–±—Ä—è 2025)

| –¢–∞–±–ª–∏—Ü–∞         | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|-----------------|--------------------|----------------------------|
| `transcription` | 1,147              | –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤   |
| `audit`         | 9,461              | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã      |
| `user_road`     | 9,434              | –ó–∞–ø–∏—Å–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏        |
| `employee`      | 34                 | –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏                  |
| `client`        | 392                | –ö–ª–∏–µ–Ω—Ç—ã                     |
| `place`         | 189                | –ú–µ—Å—Ç–∞/–æ–±—ä–µ–∫—Ç—ã               |
| `city`          | 5                  | –ì–æ—Ä–æ–¥–∞                      |
| `scenario`      | 2                  | –¢–∏–ø—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤              |
| `report_type`   | 7                  | –¢–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤                |

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- **–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é:** ~8.2 –æ—Ç—á–µ—Ç–∞
- **–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è:** 204,271 —Å–∏–º–≤–æ–ª–æ–≤ (–û—Ç–µ–ª—å –î–ò–û–ù –ò–ù–ù)
- **–°–∞–º—ã–π –¥–ª–∏–Ω–Ω—ã–π –æ—Ç—á–µ—Ç:** 13,522 —Å–∏–º–≤–æ–ª–æ–≤ (–§–∞–∫—Ç–æ—Ä—ã –≤ –∑–∞–≤–µ–¥–µ–Ω–∏–∏)
- **–î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π:** —Å –∏—é–ª—è 2025 –ø–æ —Å–µ–Ω—Ç—è–±—Ä—å 2025

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤

–ù–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤:
- `–ó–∞–≥–æ—Ä—É–π–∫–æ_–û–ª—å–≥–∞_–ê—É–¥–∏—Ç_–†–µ—Å—Ç–æ—Ä–∞–Ω*` - 9 —Ñ–∞–π–ª–æ–≤
- `–ë—É—Ä–±–æ–Ω.mp3` - 5 —Ñ–∞–π–ª–æ–≤
- `2025-04-10-–ë—É—Ä–±–æ–Ω –ö—É–Ω—Ç—ã—à–µ–≤–∞.mp3` - 4 —Ñ–∞–π–ª–∞
- –û—Ç–µ–ª–∏: –¢–∞—Å–∏–≥–æ, –ù–ï–û, –õ—É—á–∞–Ω–æ, –î–ò–û–ù
- –†–µ—Å—Ç–æ—Ä–∞–Ω—ã: –ë—É—Ä–±–æ–Ω, –¢–µ—Ä—Ä–∞ –í–∏—Ç–∞, –ü–∏—Ä, –¢—É–≥–∞–Ω –ê–≤–∞–ª—ã–º

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ —Å –∏—Ö –æ—Ç—á–µ—Ç–∞–º–∏

```sql
SELECT
    t.transcription_id,
    t.audio_file_name,
    t.transcription_date,
    LENGTH(t.transcription_text) as transcription_length,
    COUNT(a.audit_id) as reports_count
FROM transcription t
LEFT JOIN audit a ON t.transcription_id = a.transcription_id
GROUP BY t.transcription_id, t.audio_file_name, t.transcription_date, t.transcription_text
ORDER BY t.transcription_date DESC
LIMIT 10;
```

### 2. –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ —Å —Ç–∏–ø–∞–º–∏

```sql
SELECT
    t.transcription_id,
    t.audio_file_name,
    s.scenario_name,
    rt.report_type_desc,
    a.audit_id,
    LEFT(a.audit, 200) as report_preview,
    LENGTH(a.audit) as report_length
FROM transcription t
JOIN audit a ON t.transcription_id = a.transcription_id
JOIN user_road ur ON a.audit_id = ur.audit_id
JOIN scenario s ON ur.scenario_id = s.scenario_id
JOIN report_type rt ON ur.report_type_id = rt.report_type_id
WHERE t.transcription_id = 1147
ORDER BY ur.user_road_id DESC;
```

### 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º

```sql
SELECT
    s.scenario_name,
    COUNT(DISTINCT ur.audit_id) as total_reports,
    COUNT(DISTINCT a.transcription_id) as total_transcriptions
FROM scenario s
LEFT JOIN user_road ur ON s.scenario_id = ur.scenario_id
LEFT JOIN audit a ON ur.audit_id = a.audit_id
GROUP BY s.scenario_id, s.scenario_name
ORDER BY s.scenario_id;
```

### 4. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç—á–µ—Ç—ã —Ç–∏–ø–∞ "–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é"

```sql
SELECT
    t.audio_file_name,
    a.audit_date,
    e.employee_name,
    p.place_name,
    LEFT(a.audit, 300) as report_preview
FROM audit a
JOIN user_road ur ON a.audit_id = ur.audit_id
JOIN report_type rt ON ur.report_type_id = rt.report_type_id
JOIN transcription t ON a.transcription_id = t.transcription_id
LEFT JOIN employee e ON a.employee_id = e.employee_id
LEFT JOIN place p ON a.place_id = p.place_id
WHERE rt.report_type_desc = '–û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é'
ORDER BY a.audit_date DESC
LIMIT 5;
```

### 5. –ù–∞–π—Ç–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –±–µ–∑ –æ—Ç—á–µ—Ç–æ–≤

```sql
SELECT
    t.transcription_id,
    t.audio_file_name,
    t.transcription_date
FROM transcription t
LEFT JOIN audit a ON t.transcription_id = a.transcription_id
WHERE a.audit_id IS NULL
ORDER BY t.transcription_date DESC;
```

### 6. –¢–æ–ø —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞—É–¥–∏—Ç–æ–≤

```sql
SELECT
    e.employee_name,
    COUNT(a.audit_id) as total_audits,
    s.scenario_name
FROM employee e
JOIN audit a ON e.employee_id = a.employee_id
JOIN user_road ur ON a.audit_id = ur.audit_id
JOIN scenario s ON ur.scenario_id = s.scenario_id
GROUP BY e.employee_id, e.employee_name, s.scenario_name
ORDER BY total_audits DESC
LIMIT 10;
```

### 7. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

```sql
SELECT
    t.transcription_id,
    t.audio_file_name,
    t.transcription_date,
    t.transcription_text,
    e.employee_name,
    c.client_name,
    p.place_name,
    p.building_type,
    ct.city_name,
    array_agg(DISTINCT s.scenario_name) as scenarios,
    array_agg(DISTINCT rt.report_type_desc) as report_types
FROM transcription t
LEFT JOIN audit a ON t.transcription_id = a.transcription_id
LEFT JOIN user_road ur ON a.audit_id = ur.audit_id
LEFT JOIN scenario s ON ur.scenario_id = s.scenario_id
LEFT JOIN report_type rt ON ur.report_type_id = rt.report_type_id
LEFT JOIN employee e ON a.employee_id = e.employee_id
LEFT JOIN client c ON a.client_id = c.client_id
LEFT JOIN place p ON a.place_id = p.place_id
LEFT JOIN city ct ON a.city_id = ct.city_id
WHERE t.transcription_id = 1147
GROUP BY t.transcription_id, t.audio_file_name, t.transcription_date,
         t.transcription_text, e.employee_name, c.client_name,
         p.place_name, p.building_type, ct.city_name;
```

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –†–∞–±–æ—Ç–∞ —Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è–º–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏:**
   ```sql
   INSERT INTO transcription (transcription_text, audio_file_name, transcription_date, number_audio)
   VALUES (
       '–¢–µ–∫—Å—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏...',
       'audio_file.mp3',
       NOW(),
       1
   )
   RETURNING transcription_id;
   ```

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):**
   ```sql
   UPDATE transcription
   SET transcription_text = '–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç...'
   WHERE transcription_id = 1147;
   ```

### –†–∞–±–æ—Ç–∞ —Å –æ—Ç—á–µ—Ç–∞–º–∏

1. **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞:**
   ```sql
   -- –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
   INSERT INTO audit (
       audit,
       employee_id,
       client_id,
       place_id,
       audit_date,
       city_id,
       transcription_id
   )
   VALUES (
       '–¢–µ–∫—Å—Ç –æ—Ç—á–µ—Ç–∞...',
       34,
       1,
       41,
       CURRENT_DATE,
       1,
       1147
   )
   RETURNING audit_id;

   -- –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é
   INSERT INTO user_road (audit_id, scenario_id, report_type_id, building_id)
   VALUES (
       9999,  -- audit_id –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
       1,     -- –ò–Ω—Ç–µ—Ä–≤—å—é
       1,     -- –û—Ü–µ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –∏–Ω—Ç–µ—Ä–≤—å—é
       1      -- building_id
   );
   ```

2. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ + –æ—Ç—á–µ—Ç–∞:**
   ```sql
   BEGIN;

   -- –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—é
   INSERT INTO transcription (transcription_text, audio_file_name, transcription_date)
   VALUES ('–¢–µ–∫—Å—Ç...', 'file.mp3', NOW())
   RETURNING transcription_id INTO @transcription_id;

   -- –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
   INSERT INTO audit (audit, transcription_id, audit_date)
   VALUES ('–û—Ç—á–µ—Ç...', @transcription_id, CURRENT_DATE)
   RETURNING audit_id INTO @audit_id;

   -- –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é
   INSERT INTO user_road (audit_id, scenario_id, report_type_id, building_id)
   VALUES (@audit_id, 1, 1, 1);

   COMMIT;
   ```

### –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –∏ —Ç–∏–ø–∞–º–∏ –æ—Ç—á–µ—Ç–æ–≤

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –¢–∞–±–ª–∏—Ü—ã `scenario` –∏ `report_type` —è–≤–ª—è—é—Ç—Å—è **—Å–ø—Ä–∞–≤–æ—á–Ω—ã–º–∏** –∏ **–Ω–µ –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å—Å—è** –±–µ–∑ –æ—Å–æ–±–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–∞ (—Ä–µ–¥–∫–∏–π —Å–ª—É—á–∞–π):**
```sql
INSERT INTO report_type (report_type_desc, scenario_id)
VALUES ('–ù–æ–≤—ã–π —Ç–∏–ø –æ—Ç—á–µ—Ç–∞', 1);  -- 1 = –ò–Ω—Ç–µ—Ä–≤—å—é, 2 = –î–∏–∑–∞–π–Ω
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã:**
   - –ù–∞ `transcription_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `audit` (—É–∂–µ –µ—Å—Ç—å FK)
   - –ù–∞ `audit_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `user_road` (—É–∂–µ –µ—Å—Ç—å FK)

2. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –≤—ã–±–æ—Ä–∫—É:**
   ```sql
   -- –ü–ª–æ—Ö–æ (–∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Å—å TEXT)
   SELECT * FROM transcription;

   -- –•–æ—Ä–æ—à–æ (–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è)
   SELECT transcription_id, audio_file_name, transcription_date
   FROM transcription;

   -- –î–ª—è –ø—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ LEFT() –∏–ª–∏ SUBSTRING()
   SELECT LEFT(transcription_text, 200) as preview
   FROM transcription;
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ EXPLAIN –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
   ```sql
   EXPLAIN ANALYZE
   SELECT ...;
   ```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ—Ç—á–µ—Ç–∞:**
   ```sql
   SELECT COUNT(*) FROM transcription WHERE transcription_id = 1147;
   ```

2. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:**
   - –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ `audit` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è `user_road` (CASCADE)
   - –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ `transcription` ‚Üí `audit.transcription_id` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è NULL (SET NULL)

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ NULL –∑–Ω–∞—á–µ–Ω–∏–π:**
   ```sql
   SELECT
       t.transcription_id,
       COALESCE(e.employee_name, '–ù–µ —É–∫–∞–∑–∞–Ω') as employee_name
   FROM transcription t
   LEFT JOIN audit a ON t.transcription_id = a.transcription_id
   LEFT JOIN employee e ON a.employee_id = e.employee_id;
   ```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã

**–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫:**

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ nullable –∫–æ–ª–æ–Ω–∫–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
ALTER TABLE transcription
ADD COLUMN new_field VARCHAR(255);

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ NOT NULL –∫–æ–ª–æ–Ω–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
ALTER TABLE transcription
ADD COLUMN new_required_field INTEGER NOT NULL DEFAULT 0;

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞
ALTER TABLE transcription
ADD CONSTRAINT fk_new_relation
FOREIGN KEY (new_field_id) REFERENCES other_table(id)
ON UPDATE CASCADE ON DELETE SET NULL;
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —á–µ—Ä–µ–∑ Docker:**

```bash
# –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker exec voxpersona_postgres pg_dump -U voxpersona_user bot_db > backup_$(date +%Y%m%d).sql

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ —Å—Ö–µ–º—ã
docker exec voxpersona_postgres pg_dump -U voxpersona_user --schema-only bot_db > schema_backup.sql

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö
docker exec voxpersona_postgres pg_dump -U voxpersona_user --data-only bot_db > data_backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
docker exec -i voxpersona_postgres psql -U voxpersona_user bot_db < backup_20251002.sql
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –∫–æ–¥–µ:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env`
   - –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ Docker secrets

2. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   ```sql
   -- –°–æ–∑–¥–∞–Ω–∏–µ readonly –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   CREATE USER readonly_user WITH PASSWORD 'password';
   GRANT CONNECT ON DATABASE bot_db TO readonly_user;
   GRANT USAGE ON SCHEMA public TO readonly_user;
   GRANT SELECT ON ALL TABLES IN SCHEMA public TO readonly_user;
   ```

3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** (Prepared Statements) –≤ –∫–æ–¥–µ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç SQL-injection.

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
-- –†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan
FROM pg_stat_user_indexes
WHERE idx_scan = 0
ORDER BY schemaname, tablename;

-- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Ç—Ä–µ–±—É–µ—Ç pg_stat_statements)
SELECT
    query,
    calls,
    total_time,
    mean_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- `MINIO_INTEGRATION.md` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MinIO –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
- `DEPLOYMENT_GUIDE.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `MODEL_UPGRADE_DOCUMENTATION.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é AI –º–æ–¥–µ–ª–µ–π

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ:**
```bash
# –ß–µ—Ä–µ–∑ Docker
docker exec -it voxpersona_postgres psql -U voxpersona_user -d bot_db

# –° —Ö–æ—Å—Ç–∞
psql -h localhost -p 5432 -U voxpersona_user -d bot_db
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
```sql
\dt                    -- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
\d table_name          -- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
\d+ table_name         -- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
\df                    -- –°–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π
\dv                    -- –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (views)
\l                     -- –°–ø–∏—Å–æ–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
\du                    -- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

**–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö:**
```bash
# –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
docker exec voxpersona_postgres psql -U voxpersona_user -d bot_db \
  -c "COPY transcription TO STDOUT WITH CSV HEADER" > transcriptions.csv

# –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤
docker exec voxpersona_postgres psql -U voxpersona_user -d bot_db \
  -c "COPY audit TO STDOUT WITH CSV HEADER" > audits.csv
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–¢–∏–ø—ã TEXT vs VARCHAR:**
   - `transcription_text` –∏ `audit` –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∏–ø `TEXT` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
   - –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ `VARCHAR` - —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç –¥–ª–∏–Ω—É

2. **Nullable –ø–æ–ª—è:**
   - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª–µ–π –≤ `audit` –∏ `transcription` –¥–æ–ø—É—Å–∫–∞—é—Ç NULL
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

3. **Cascade Delete:**
   - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `user_road` –ù–ï —É–¥–∞–ª—è–µ—Ç –æ—Ç—á–µ—Ç –∏–∑ `audit`
   - –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `audit` —É–¥–∞–ª—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤ `user_road`

4. **Foreign Key ON DELETE SET NULL:**
   - –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è
   - –ü–æ–ª–µ `transcription_id` –≤ `audit` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è NULL

5. **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–π:**
   - –û–¥–Ω–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–µ—Ä—Å–∏–π –æ—Ç—á–µ—Ç–æ–≤
   - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ `transcription_id`, –∞ –Ω–µ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞       | –í–µ—Ä—Å–∏—è | –ê–≤—Ç–æ—Ä          | –ò–∑–º–µ–Ω–µ–Ω–∏—è                                |
|------------|--------|----------------|------------------------------------------|
| 02.10.2025 | 1.0    | Claude + Team  | –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏               |

---

## üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ VoxPersona.

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/leonid998/VoxPersona

---

*–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö VoxPersona (—Å–µ—Ä–≤–µ—Ä 172.237.73.207) –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –Ω–∞ 2 –æ–∫—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞.*
